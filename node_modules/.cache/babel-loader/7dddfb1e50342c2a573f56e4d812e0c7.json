{"ast":null,"code":"/*global require,module*/\n\"use strict\";\n\nvar CodeMirror = require(\"codemirror\");\n\nrequire(\"codemirror/addon/edit/continuelist.js\");\n\nrequire(\"./codemirror/tablist\");\n\nrequire(\"codemirror/addon/display/fullscreen.js\");\n\nrequire(\"codemirror/mode/markdown/markdown.js\");\n\nrequire(\"codemirror/addon/mode/overlay.js\");\n\nrequire(\"codemirror/addon/display/placeholder.js\");\n\nrequire(\"codemirror/addon/selection/mark-selection.js\");\n\nrequire(\"codemirror/mode/gfm/gfm.js\");\n\nrequire(\"codemirror/mode/xml/xml.js\");\n\nvar CodeMirrorSpellChecker = require(\"codemirror-spell-checker\");\n\nvar marked = require(\"marked\"); // Some variables\n\n\nvar isMac = /Mac/.test(navigator.platform); // Mapping of actions that can be bound to keyboard shortcuts or toolbar buttons\n\nvar bindings = {\n  \"toggleBold\": toggleBold,\n  \"toggleItalic\": toggleItalic,\n  \"drawLink\": drawLink,\n  \"toggleHeadingSmaller\": toggleHeadingSmaller,\n  \"toggleHeadingBigger\": toggleHeadingBigger,\n  \"drawImage\": drawImage,\n  \"toggleBlockquote\": toggleBlockquote,\n  \"toggleOrderedList\": toggleOrderedList,\n  \"toggleUnorderedList\": toggleUnorderedList,\n  \"toggleCodeBlock\": toggleCodeBlock,\n  \"togglePreview\": togglePreview,\n  \"toggleStrikethrough\": toggleStrikethrough,\n  \"toggleHeading1\": toggleHeading1,\n  \"toggleHeading2\": toggleHeading2,\n  \"toggleHeading3\": toggleHeading3,\n  \"cleanBlock\": cleanBlock,\n  \"drawTable\": drawTable,\n  \"drawHorizontalRule\": drawHorizontalRule,\n  \"undo\": undo,\n  \"redo\": redo,\n  \"toggleSideBySide\": toggleSideBySide,\n  \"toggleFullScreen\": toggleFullScreen\n};\nvar shortcuts = {\n  \"toggleBold\": \"Cmd-B\",\n  \"toggleItalic\": \"Cmd-I\",\n  \"drawLink\": \"Cmd-K\",\n  \"toggleHeadingSmaller\": \"Cmd-H\",\n  \"toggleHeadingBigger\": \"Shift-Cmd-H\",\n  \"cleanBlock\": \"Cmd-E\",\n  \"drawImage\": \"Cmd-Alt-I\",\n  \"toggleBlockquote\": \"Cmd-'\",\n  \"toggleOrderedList\": \"Cmd-Alt-L\",\n  \"toggleUnorderedList\": \"Cmd-L\",\n  \"toggleCodeBlock\": \"Cmd-Alt-C\",\n  \"togglePreview\": \"Cmd-P\",\n  \"toggleSideBySide\": \"F9\",\n  \"toggleFullScreen\": \"F11\"\n};\n\nvar getBindingName = function (f) {\n  for (var key in bindings) {\n    if (bindings[key] === f) {\n      return key;\n    }\n  }\n\n  return null;\n};\n\nvar isMobile = function () {\n  var check = false;\n\n  (function (a) {\n    if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true;\n  })(navigator.userAgent || navigator.vendor || window.opera);\n\n  return check;\n};\n/**\n * Fix shortcut. Mac use Command, others use Ctrl.\n */\n\n\nfunction fixShortcut(name) {\n  if (isMac) {\n    name = name.replace(\"Ctrl\", \"Cmd\");\n  } else {\n    name = name.replace(\"Cmd\", \"Ctrl\");\n  }\n\n  return name;\n}\n/**\n * Create icon element for toolbar.\n */\n\n\nfunction createIcon(options, enableTooltips, shortcuts) {\n  options = options || {};\n  var el = document.createElement(\"a\");\n  enableTooltips = enableTooltips == undefined ? true : enableTooltips;\n\n  if (options.title && enableTooltips) {\n    el.title = createTootlip(options.title, options.action, shortcuts);\n\n    if (isMac) {\n      el.title = el.title.replace(\"Ctrl\", \"⌘\");\n      el.title = el.title.replace(\"Alt\", \"⌥\");\n    }\n  }\n\n  el.tabIndex = -1;\n  el.className = options.className;\n  return el;\n}\n\nfunction createSep() {\n  var el = document.createElement(\"i\");\n  el.className = \"separator\";\n  el.innerHTML = \"|\";\n  return el;\n}\n\nfunction createTootlip(title, action, shortcuts) {\n  var actionName;\n  var tooltip = title;\n\n  if (action) {\n    actionName = getBindingName(action);\n\n    if (shortcuts[actionName]) {\n      tooltip += \" (\" + fixShortcut(shortcuts[actionName]) + \")\";\n    }\n  }\n\n  return tooltip;\n}\n/**\n * The state of CodeMirror at the given position.\n */\n\n\nfunction getState(cm, pos) {\n  pos = pos || cm.getCursor(\"start\");\n  var stat = cm.getTokenAt(pos);\n  if (!stat.type) return {};\n  var types = stat.type.split(\" \");\n  var ret = {},\n      data,\n      text;\n\n  for (var i = 0; i < types.length; i++) {\n    data = types[i];\n\n    if (data === \"strong\") {\n      ret.bold = true;\n    } else if (data === \"variable-2\") {\n      text = cm.getLine(pos.line);\n\n      if (/^\\s*\\d+\\.\\s/.test(text)) {\n        ret[\"ordered-list\"] = true;\n      } else {\n        ret[\"unordered-list\"] = true;\n      }\n    } else if (data === \"atom\") {\n      ret.quote = true;\n    } else if (data === \"em\") {\n      ret.italic = true;\n    } else if (data === \"quote\") {\n      ret.quote = true;\n    } else if (data === \"strikethrough\") {\n      ret.strikethrough = true;\n    } else if (data === \"comment\") {\n      ret.code = true;\n    } else if (data === \"link\") {\n      ret.link = true;\n    } else if (data === \"tag\") {\n      ret.image = true;\n    } else if (data.match(/^header(\\-[1-6])?$/)) {\n      ret[data.replace(\"header\", \"heading\")] = true;\n    }\n  }\n\n  return ret;\n} // Saved overflow setting\n\n\nvar saved_overflow = \"\";\n/**\n * Toggle full screen of the editor.\n */\n\nfunction toggleFullScreen(editor) {\n  // Set fullscreen\n  var cm = editor.codemirror;\n  cm.setOption(\"fullScreen\", !cm.getOption(\"fullScreen\")); // Prevent scrolling on body during fullscreen active\n\n  if (cm.getOption(\"fullScreen\")) {\n    saved_overflow = document.body.style.overflow;\n    document.body.style.overflow = \"hidden\";\n  } else {\n    document.body.style.overflow = saved_overflow;\n  } // Update toolbar class\n\n\n  var wrap = cm.getWrapperElement();\n\n  if (!/fullscreen/.test(wrap.previousSibling.className)) {\n    wrap.previousSibling.className += \" fullscreen\";\n  } else {\n    wrap.previousSibling.className = wrap.previousSibling.className.replace(/\\s*fullscreen\\b/, \"\");\n  } // Update toolbar button\n\n\n  var toolbarButton = editor.toolbarElements.fullscreen;\n\n  if (!/active/.test(toolbarButton.className)) {\n    toolbarButton.className += \" active\";\n  } else {\n    toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, \"\");\n  } // Hide side by side if needed\n\n\n  var sidebyside = cm.getWrapperElement().nextSibling;\n  if (/editor-preview-active-side/.test(sidebyside.className)) toggleSideBySide(editor);\n}\n/**\n * Action for toggling bold.\n */\n\n\nfunction toggleBold(editor) {\n  _toggleBlock(editor, \"bold\", editor.options.blockStyles.bold);\n}\n/**\n * Action for toggling italic.\n */\n\n\nfunction toggleItalic(editor) {\n  _toggleBlock(editor, \"italic\", editor.options.blockStyles.italic);\n}\n/**\n * Action for toggling strikethrough.\n */\n\n\nfunction toggleStrikethrough(editor) {\n  _toggleBlock(editor, \"strikethrough\", \"~~\");\n}\n/**\n * Action for toggling code block.\n */\n\n\nfunction toggleCodeBlock(editor) {\n  var fenceCharsToInsert = editor.options.blockStyles.code;\n\n  function fencing_line(line) {\n    /* return true, if this is a ``` or ~~~ line */\n    if (typeof line !== \"object\") {\n      throw \"fencing_line() takes a 'line' object (not a line number, or line text).  Got: \" + typeof line + \": \" + line;\n    }\n\n    return line.styles && line.styles[2] && line.styles[2].indexOf(\"formatting-code-block\") !== -1;\n  }\n\n  function token_state(token) {\n    // base goes an extra level deep when mode backdrops are used, e.g. spellchecker on\n    return token.state.base.base || token.state.base;\n  }\n\n  function code_type(cm, line_num, line, firstTok, lastTok) {\n    /*\n     * Return \"single\", \"indented\", \"fenced\" or false\n     *\n     * cm and line_num are required.  Others are optional for efficiency\n     *   To check in the middle of a line, pass in firstTok yourself.\n     */\n    line = line || cm.getLineHandle(line_num);\n    firstTok = firstTok || cm.getTokenAt({\n      line: line_num,\n      ch: 1\n    });\n    lastTok = lastTok || !!line.text && cm.getTokenAt({\n      line: line_num,\n      ch: line.text.length - 1\n    });\n    var types = firstTok.type ? firstTok.type.split(\" \") : [];\n\n    if (lastTok && token_state(lastTok).indentedCode) {\n      // have to check last char, since first chars of first line aren\"t marked as indented\n      return \"indented\";\n    } else if (types.indexOf(\"comment\") === -1) {\n      // has to be after \"indented\" check, since first chars of first indented line aren\"t marked as such\n      return false;\n    } else if (token_state(firstTok).fencedChars || token_state(lastTok).fencedChars || fencing_line(line)) {\n      return \"fenced\";\n    } else {\n      return \"single\";\n    }\n  }\n\n  function insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert) {\n    var start_line_sel = cur_start.line + 1,\n        end_line_sel = cur_end.line + 1,\n        sel_multi = cur_start.line !== cur_end.line,\n        repl_start = fenceCharsToInsert + \"\\n\",\n        repl_end = \"\\n\" + fenceCharsToInsert;\n\n    if (sel_multi) {\n      end_line_sel++;\n    } // handle last char including \\n or not\n\n\n    if (sel_multi && cur_end.ch === 0) {\n      repl_end = fenceCharsToInsert + \"\\n\";\n      end_line_sel--;\n    }\n\n    _replaceSelection(cm, false, [repl_start, repl_end]);\n\n    cm.setSelection({\n      line: start_line_sel,\n      ch: 0\n    }, {\n      line: end_line_sel,\n      ch: 0\n    });\n  }\n\n  var cm = editor.codemirror,\n      cur_start = cm.getCursor(\"start\"),\n      cur_end = cm.getCursor(\"end\"),\n      tok = cm.getTokenAt({\n    line: cur_start.line,\n    ch: cur_start.ch || 1\n  }),\n      // avoid ch 0 which is a cursor pos but not token\n  line = cm.getLineHandle(cur_start.line),\n      is_code = code_type(cm, cur_start.line, line, tok);\n  var block_start, block_end, lineCount;\n\n  if (is_code === \"single\") {\n    // similar to some SimpleMDE _toggleBlock logic\n    var start = line.text.slice(0, cur_start.ch).replace(\"`\", \"\"),\n        end = line.text.slice(cur_start.ch).replace(\"`\", \"\");\n    cm.replaceRange(start + end, {\n      line: cur_start.line,\n      ch: 0\n    }, {\n      line: cur_start.line,\n      ch: 99999999999999\n    });\n    cur_start.ch--;\n\n    if (cur_start !== cur_end) {\n      cur_end.ch--;\n    }\n\n    cm.setSelection(cur_start, cur_end);\n    cm.focus();\n  } else if (is_code === \"fenced\") {\n    if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n      // use selection\n      // find the fenced line so we know what type it is (tilde, backticks, number of them)\n      for (block_start = cur_start.line; block_start >= 0; block_start--) {\n        line = cm.getLineHandle(block_start);\n\n        if (fencing_line(line)) {\n          break;\n        }\n      }\n\n      var fencedTok = cm.getTokenAt({\n        line: block_start,\n        ch: 1\n      });\n      var fence_chars = token_state(fencedTok).fencedChars;\n      var start_text, start_line;\n      var end_text, end_line; // check for selection going up against fenced lines, in which case we don't want to add more fencing\n\n      if (fencing_line(cm.getLineHandle(cur_start.line))) {\n        start_text = \"\";\n        start_line = cur_start.line;\n      } else if (fencing_line(cm.getLineHandle(cur_start.line - 1))) {\n        start_text = \"\";\n        start_line = cur_start.line - 1;\n      } else {\n        start_text = fence_chars + \"\\n\";\n        start_line = cur_start.line;\n      }\n\n      if (fencing_line(cm.getLineHandle(cur_end.line))) {\n        end_text = \"\";\n        end_line = cur_end.line;\n\n        if (cur_end.ch === 0) {\n          end_line += 1;\n        }\n      } else if (cur_end.ch !== 0 && fencing_line(cm.getLineHandle(cur_end.line + 1))) {\n        end_text = \"\";\n        end_line = cur_end.line + 1;\n      } else {\n        end_text = fence_chars + \"\\n\";\n        end_line = cur_end.line + 1;\n      }\n\n      if (cur_end.ch === 0) {\n        // full last line selected, putting cursor at beginning of next\n        end_line -= 1;\n      }\n\n      cm.operation(function () {\n        // end line first, so that line numbers don't change\n        cm.replaceRange(end_text, {\n          line: end_line,\n          ch: 0\n        }, {\n          line: end_line + (end_text ? 0 : 1),\n          ch: 0\n        });\n        cm.replaceRange(start_text, {\n          line: start_line,\n          ch: 0\n        }, {\n          line: start_line + (start_text ? 0 : 1),\n          ch: 0\n        });\n      });\n      cm.setSelection({\n        line: start_line + (start_text ? 1 : 0),\n        ch: 0\n      }, {\n        line: end_line + (start_text ? 1 : -1),\n        ch: 0\n      });\n      cm.focus();\n    } else {\n      // no selection, search for ends of this fenced block\n      var search_from = cur_start.line;\n\n      if (fencing_line(cm.getLineHandle(cur_start.line))) {\n        // gets a little tricky if cursor is right on a fenced line\n        if (code_type(cm, cur_start.line + 1) === \"fenced\") {\n          block_start = cur_start.line;\n          search_from = cur_start.line + 1; // for searching for \"end\"\n        } else {\n          block_end = cur_start.line;\n          search_from = cur_start.line - 1; // for searching for \"start\"\n        }\n      }\n\n      if (block_start === undefined) {\n        for (block_start = search_from; block_start >= 0; block_start--) {\n          line = cm.getLineHandle(block_start);\n\n          if (fencing_line(line)) {\n            break;\n          }\n        }\n      }\n\n      if (block_end === undefined) {\n        lineCount = cm.lineCount();\n\n        for (block_end = search_from; block_end < lineCount; block_end++) {\n          line = cm.getLineHandle(block_end);\n\n          if (fencing_line(line)) {\n            break;\n          }\n        }\n      }\n\n      cm.operation(function () {\n        cm.replaceRange(\"\", {\n          line: block_start,\n          ch: 0\n        }, {\n          line: block_start + 1,\n          ch: 0\n        });\n        cm.replaceRange(\"\", {\n          line: block_end - 1,\n          ch: 0\n        }, {\n          line: block_end,\n          ch: 0\n        });\n      });\n      cm.focus();\n    }\n  } else if (is_code === \"indented\") {\n    if (cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n      // use selection\n      block_start = cur_start.line;\n      block_end = cur_end.line;\n\n      if (cur_end.ch === 0) {\n        block_end--;\n      }\n    } else {\n      // no selection, search for ends of this indented block\n      for (block_start = cur_start.line; block_start >= 0; block_start--) {\n        line = cm.getLineHandle(block_start);\n\n        if (line.text.match(/^\\s*$/)) {\n          // empty or all whitespace - keep going\n          continue;\n        } else {\n          if (code_type(cm, block_start, line) !== \"indented\") {\n            block_start += 1;\n            break;\n          }\n        }\n      }\n\n      lineCount = cm.lineCount();\n\n      for (block_end = cur_start.line; block_end < lineCount; block_end++) {\n        line = cm.getLineHandle(block_end);\n\n        if (line.text.match(/^\\s*$/)) {\n          // empty or all whitespace - keep going\n          continue;\n        } else {\n          if (code_type(cm, block_end, line) !== \"indented\") {\n            block_end -= 1;\n            break;\n          }\n        }\n      }\n    } // if we are going to un-indent based on a selected set of lines, and the next line is indented too, we need to\n    // insert a blank line so that the next line(s) continue to be indented code\n\n\n    var next_line = cm.getLineHandle(block_end + 1),\n        next_line_last_tok = next_line && cm.getTokenAt({\n      line: block_end + 1,\n      ch: next_line.text.length - 1\n    }),\n        next_line_indented = next_line_last_tok && token_state(next_line_last_tok).indentedCode;\n\n    if (next_line_indented) {\n      cm.replaceRange(\"\\n\", {\n        line: block_end + 1,\n        ch: 0\n      });\n    }\n\n    for (var i = block_start; i <= block_end; i++) {\n      cm.indentLine(i, \"subtract\"); // TODO: this doesn't get tracked in the history, so can't be undone :(\n    }\n\n    cm.focus();\n  } else {\n    // insert code formatting\n    var no_sel_and_starting_of_line = cur_start.line === cur_end.line && cur_start.ch === cur_end.ch && cur_start.ch === 0;\n    var sel_multi = cur_start.line !== cur_end.line;\n\n    if (no_sel_and_starting_of_line || sel_multi) {\n      insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert);\n    } else {\n      _replaceSelection(cm, false, [\"`\", \"`\"]);\n    }\n  }\n}\n/**\n * Action for toggling blockquote.\n */\n\n\nfunction toggleBlockquote(editor) {\n  var cm = editor.codemirror;\n\n  _toggleLine(cm, \"quote\");\n}\n/**\n * Action for toggling heading size: normal -> h1 -> h2 -> h3 -> h4 -> h5 -> h6 -> normal\n */\n\n\nfunction toggleHeadingSmaller(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, \"smaller\");\n}\n/**\n * Action for toggling heading size: normal -> h6 -> h5 -> h4 -> h3 -> h2 -> h1 -> normal\n */\n\n\nfunction toggleHeadingBigger(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, \"bigger\");\n}\n/**\n * Action for toggling heading size 1\n */\n\n\nfunction toggleHeading1(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 1);\n}\n/**\n * Action for toggling heading size 2\n */\n\n\nfunction toggleHeading2(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 2);\n}\n/**\n * Action for toggling heading size 3\n */\n\n\nfunction toggleHeading3(editor) {\n  var cm = editor.codemirror;\n\n  _toggleHeading(cm, undefined, 3);\n}\n/**\n * Action for toggling ul.\n */\n\n\nfunction toggleUnorderedList(editor) {\n  var cm = editor.codemirror;\n\n  _toggleLine(cm, \"unordered-list\");\n}\n/**\n * Action for toggling ol.\n */\n\n\nfunction toggleOrderedList(editor) {\n  var cm = editor.codemirror;\n\n  _toggleLine(cm, \"ordered-list\");\n}\n/**\n * Action for clean block (remove headline, list, blockquote code, markers)\n */\n\n\nfunction cleanBlock(editor) {\n  var cm = editor.codemirror;\n\n  _cleanBlock(cm);\n}\n/**\n * Action for drawing a link.\n */\n\n\nfunction drawLink(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n  var url = \"http://\";\n\n  if (options.promptURLs) {\n    url = prompt(options.promptTexts.link);\n\n    if (!url) {\n      return false;\n    }\n  }\n\n  _replaceSelection(cm, stat.link, options.insertTexts.link, url);\n}\n/**\n * Action for drawing an img.\n */\n\n\nfunction drawImage(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n  var url = \"http://\";\n\n  if (options.promptURLs) {\n    url = prompt(options.promptTexts.image);\n\n    if (!url) {\n      return false;\n    }\n  }\n\n  _replaceSelection(cm, stat.image, options.insertTexts.image, url);\n}\n/**\n * Action for drawing a table.\n */\n\n\nfunction drawTable(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n\n  _replaceSelection(cm, stat.table, options.insertTexts.table);\n}\n/**\n * Action for drawing a horizontal rule.\n */\n\n\nfunction drawHorizontalRule(editor) {\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var options = editor.options;\n\n  _replaceSelection(cm, stat.image, options.insertTexts.horizontalRule);\n}\n/**\n * Undo action.\n */\n\n\nfunction undo(editor) {\n  var cm = editor.codemirror;\n  cm.undo();\n  cm.focus();\n}\n/**\n * Redo action.\n */\n\n\nfunction redo(editor) {\n  var cm = editor.codemirror;\n  cm.redo();\n  cm.focus();\n}\n/**\n * Toggle side by side preview\n */\n\n\nfunction toggleSideBySide(editor) {\n  var cm = editor.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n  var toolbarButton = editor.toolbarElements[\"side-by-side\"];\n  var useSideBySideListener = false;\n\n  if (/editor-preview-active-side/.test(preview.className)) {\n    preview.className = preview.className.replace(/\\s*editor-preview-active-side\\s*/g, \"\");\n    toolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, \"\");\n    wrapper.className = wrapper.className.replace(/\\s*CodeMirror-sided\\s*/g, \" \");\n  } else {\n    // When the preview button is clicked for the first time,\n    // give some time for the transition from editor.css to fire and the view to slide from right to left,\n    // instead of just appearing.\n    setTimeout(function () {\n      if (!cm.getOption(\"fullScreen\")) toggleFullScreen(editor);\n      preview.className += \" editor-preview-active-side\";\n    }, 1);\n    toolbarButton.className += \" active\";\n    wrapper.className += \" CodeMirror-sided\";\n    useSideBySideListener = true;\n  } // Hide normal preview if active\n\n\n  var previewNormal = wrapper.lastChild;\n\n  if (/editor-preview-active/.test(previewNormal.className)) {\n    previewNormal.className = previewNormal.className.replace(/\\s*editor-preview-active\\s*/g, \"\");\n    var toolbar = editor.toolbarElements.preview;\n    var toolbar_div = wrapper.previousSibling;\n    toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, \"\");\n    toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, \"\");\n  }\n\n  var sideBySideRenderingFunction = function () {\n    preview.innerHTML = editor.options.previewRender(editor.value(), preview);\n  };\n\n  if (!cm.sideBySideRenderingFunction) {\n    cm.sideBySideRenderingFunction = sideBySideRenderingFunction;\n  }\n\n  if (useSideBySideListener) {\n    preview.innerHTML = editor.options.previewRender(editor.value(), preview);\n    cm.on(\"update\", cm.sideBySideRenderingFunction);\n  } else {\n    cm.off(\"update\", cm.sideBySideRenderingFunction);\n  } // Refresh to fix selection being off (#309)\n\n\n  cm.refresh();\n}\n/**\n * Preview action.\n */\n\n\nfunction togglePreview(editor) {\n  var cm = editor.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var toolbar_div = wrapper.previousSibling;\n  var toolbar = editor.options.toolbar ? editor.toolbarElements.preview : false;\n  var preview = wrapper.lastChild;\n\n  if (!preview || !/editor-preview/.test(preview.className)) {\n    preview = document.createElement(\"div\");\n    preview.className = \"editor-preview\";\n    wrapper.appendChild(preview);\n  }\n\n  if (/editor-preview-active/.test(preview.className)) {\n    preview.className = preview.className.replace(/\\s*editor-preview-active\\s*/g, \"\");\n\n    if (toolbar) {\n      toolbar.className = toolbar.className.replace(/\\s*active\\s*/g, \"\");\n      toolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, \"\");\n    }\n  } else {\n    // When the preview button is clicked for the first time,\n    // give some time for the transition from editor.css to fire and the view to slide from right to left,\n    // instead of just appearing.\n    setTimeout(function () {\n      preview.className += \" editor-preview-active\";\n    }, 1);\n\n    if (toolbar) {\n      toolbar.className += \" active\";\n      toolbar_div.className += \" disabled-for-preview\";\n    }\n  }\n\n  preview.innerHTML = editor.options.previewRender(editor.value(), preview); // Turn off side by side if needed\n\n  var sidebyside = cm.getWrapperElement().nextSibling;\n  if (/editor-preview-active-side/.test(sidebyside.className)) toggleSideBySide(editor);\n}\n\nfunction _replaceSelection(cm, active, startEnd, url) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var text;\n  var start = startEnd[0];\n  var end = startEnd[1];\n  var startPoint = cm.getCursor(\"start\");\n  var endPoint = cm.getCursor(\"end\");\n\n  if (url) {\n    end = end.replace(\"#url#\", url);\n  }\n\n  if (active) {\n    text = cm.getLine(startPoint.line);\n    start = text.slice(0, startPoint.ch);\n    end = text.slice(startPoint.ch);\n    cm.replaceRange(start + end, {\n      line: startPoint.line,\n      ch: 0\n    });\n  } else {\n    text = cm.getSelection();\n    cm.replaceSelection(start + text + end);\n    startPoint.ch += start.length;\n\n    if (startPoint !== endPoint) {\n      endPoint.ch += start.length;\n    }\n  }\n\n  cm.setSelection(startPoint, endPoint);\n  cm.focus();\n}\n\nfunction _toggleHeading(cm, direction, size) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var startPoint = cm.getCursor(\"start\");\n  var endPoint = cm.getCursor(\"end\");\n\n  for (var i = startPoint.line; i <= endPoint.line; i++) {\n    (function (i) {\n      var text = cm.getLine(i);\n      var currHeadingLevel = text.search(/[^#]/);\n\n      if (direction !== undefined) {\n        if (currHeadingLevel <= 0) {\n          if (direction == \"bigger\") {\n            text = \"###### \" + text;\n          } else {\n            text = \"# \" + text;\n          }\n        } else if (currHeadingLevel == 6 && direction == \"smaller\") {\n          text = text.substr(7);\n        } else if (currHeadingLevel == 1 && direction == \"bigger\") {\n          text = text.substr(2);\n        } else {\n          if (direction == \"bigger\") {\n            text = text.substr(1);\n          } else {\n            text = \"#\" + text;\n          }\n        }\n      } else {\n        if (size == 1) {\n          if (currHeadingLevel <= 0) {\n            text = \"# \" + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = \"# \" + text.substr(currHeadingLevel + 1);\n          }\n        } else if (size == 2) {\n          if (currHeadingLevel <= 0) {\n            text = \"## \" + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = \"## \" + text.substr(currHeadingLevel + 1);\n          }\n        } else {\n          if (currHeadingLevel <= 0) {\n            text = \"### \" + text;\n          } else if (currHeadingLevel == size) {\n            text = text.substr(currHeadingLevel + 1);\n          } else {\n            text = \"### \" + text.substr(currHeadingLevel + 1);\n          }\n        }\n      }\n\n      cm.replaceRange(text, {\n        line: i,\n        ch: 0\n      }, {\n        line: i,\n        ch: 99999999999999\n      });\n    })(i);\n  }\n\n  cm.focus();\n}\n\nfunction _toggleLine(cm, name) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var stat = getState(cm);\n  var startPoint = cm.getCursor(\"start\");\n  var endPoint = cm.getCursor(\"end\");\n  var repl = {\n    \"quote\": /^(\\s*)\\>\\s+/,\n    \"unordered-list\": /^(\\s*)(\\*|\\-|\\+)\\s+/,\n    \"ordered-list\": /^(\\s*)\\d+\\.\\s+/\n  };\n  var map = {\n    \"quote\": \"> \",\n    \"unordered-list\": \"* \",\n    \"ordered-list\": \"1. \"\n  };\n\n  for (var i = startPoint.line; i <= endPoint.line; i++) {\n    (function (i) {\n      var text = cm.getLine(i);\n\n      if (stat[name]) {\n        text = text.replace(repl[name], \"$1\");\n      } else {\n        text = map[name] + text;\n      }\n\n      cm.replaceRange(text, {\n        line: i,\n        ch: 0\n      }, {\n        line: i,\n        ch: 99999999999999\n      });\n    })(i);\n  }\n\n  cm.focus();\n}\n\nfunction _toggleBlock(editor, type, start_chars, end_chars) {\n  if (/editor-preview-active/.test(editor.codemirror.getWrapperElement().lastChild.className)) return;\n  end_chars = typeof end_chars === \"undefined\" ? start_chars : end_chars;\n  var cm = editor.codemirror;\n  var stat = getState(cm);\n  var text;\n  var start = start_chars;\n  var end = end_chars;\n  var startPoint = cm.getCursor(\"start\");\n  var endPoint = cm.getCursor(\"end\");\n\n  if (stat[type]) {\n    text = cm.getLine(startPoint.line);\n    start = text.slice(0, startPoint.ch);\n    end = text.slice(startPoint.ch);\n\n    if (type == \"bold\") {\n      start = start.replace(/(\\*\\*|__)(?![\\s\\S]*(\\*\\*|__))/, \"\");\n      end = end.replace(/(\\*\\*|__)/, \"\");\n    } else if (type == \"italic\") {\n      start = start.replace(/(\\*|_)(?![\\s\\S]*(\\*|_))/, \"\");\n      end = end.replace(/(\\*|_)/, \"\");\n    } else if (type == \"strikethrough\") {\n      start = start.replace(/(\\*\\*|~~)(?![\\s\\S]*(\\*\\*|~~))/, \"\");\n      end = end.replace(/(\\*\\*|~~)/, \"\");\n    }\n\n    cm.replaceRange(start + end, {\n      line: startPoint.line,\n      ch: 0\n    }, {\n      line: startPoint.line,\n      ch: 99999999999999\n    });\n\n    if (type == \"bold\" || type == \"strikethrough\") {\n      startPoint.ch -= 2;\n\n      if (startPoint !== endPoint) {\n        endPoint.ch -= 2;\n      }\n    } else if (type == \"italic\") {\n      startPoint.ch -= 1;\n\n      if (startPoint !== endPoint) {\n        endPoint.ch -= 1;\n      }\n    }\n  } else {\n    text = cm.getSelection();\n\n    if (type == \"bold\") {\n      text = text.split(\"**\").join(\"\");\n      text = text.split(\"__\").join(\"\");\n    } else if (type == \"italic\") {\n      text = text.split(\"*\").join(\"\");\n      text = text.split(\"_\").join(\"\");\n    } else if (type == \"strikethrough\") {\n      text = text.split(\"~~\").join(\"\");\n    }\n\n    cm.replaceSelection(start + text + end);\n    startPoint.ch += start_chars.length;\n    endPoint.ch = startPoint.ch + text.length;\n  }\n\n  cm.setSelection(startPoint, endPoint);\n  cm.focus();\n}\n\nfunction _cleanBlock(cm) {\n  if (/editor-preview-active/.test(cm.getWrapperElement().lastChild.className)) return;\n  var startPoint = cm.getCursor(\"start\");\n  var endPoint = cm.getCursor(\"end\");\n  var text;\n\n  for (var line = startPoint.line; line <= endPoint.line; line++) {\n    text = cm.getLine(line);\n    text = text.replace(/^[ ]*([# ]+|\\*|\\-|[> ]+|[0-9]+(.|\\)))[ ]*/, \"\");\n    cm.replaceRange(text, {\n      line: line,\n      ch: 0\n    }, {\n      line: line,\n      ch: 99999999999999\n    });\n  }\n} // Merge the properties of one object into another.\n\n\nfunction _mergeProperties(target, source) {\n  for (var property in source) {\n    if (source.hasOwnProperty(property)) {\n      if (source[property] instanceof Array) {\n        target[property] = source[property].concat(target[property] instanceof Array ? target[property] : []);\n      } else if (source[property] !== null && typeof source[property] === \"object\" && source[property].constructor === Object) {\n        target[property] = _mergeProperties(target[property] || {}, source[property]);\n      } else {\n        target[property] = source[property];\n      }\n    }\n  }\n\n  return target;\n} // Merge an arbitrary number of objects into one.\n\n\nfunction extend(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    target = _mergeProperties(target, arguments[i]);\n  }\n\n  return target;\n}\n/* The right word count in respect for CJK. */\n\n\nfunction wordCount(data) {\n  var pattern = /[a-zA-Z0-9_\\u0392-\\u03c9\\u0410-\\u04F9]+|[\\u4E00-\\u9FFF\\u3400-\\u4dbf\\uf900-\\ufaff\\u3040-\\u309f\\uac00-\\ud7af]+/g;\n  var m = data.match(pattern);\n  var count = 0;\n  if (m === null) return count;\n\n  for (var i = 0; i < m.length; i++) {\n    if (m[i].charCodeAt(0) >= 0x4E00) {\n      count += m[i].length;\n    } else {\n      count += 1;\n    }\n  }\n\n  return count;\n}\n\nvar toolbarBuiltInButtons = {\n  \"bold\": {\n    name: \"bold\",\n    action: toggleBold,\n    className: \"fa fa-bold\",\n    title: \"Bold\",\n    default: true\n  },\n  \"italic\": {\n    name: \"italic\",\n    action: toggleItalic,\n    className: \"fa fa-italic\",\n    title: \"Italic\",\n    default: true\n  },\n  \"strikethrough\": {\n    name: \"strikethrough\",\n    action: toggleStrikethrough,\n    className: \"fa fa-strikethrough\",\n    title: \"Strikethrough\"\n  },\n  \"heading\": {\n    name: \"heading\",\n    action: toggleHeadingSmaller,\n    className: \"fa fa-header\",\n    title: \"Heading\",\n    default: true\n  },\n  \"heading-smaller\": {\n    name: \"heading-smaller\",\n    action: toggleHeadingSmaller,\n    className: \"fa fa-header fa-header-x fa-header-smaller\",\n    title: \"Smaller Heading\"\n  },\n  \"heading-bigger\": {\n    name: \"heading-bigger\",\n    action: toggleHeadingBigger,\n    className: \"fa fa-header fa-header-x fa-header-bigger\",\n    title: \"Bigger Heading\"\n  },\n  \"heading-1\": {\n    name: \"heading-1\",\n    action: toggleHeading1,\n    className: \"fa fa-header fa-header-x fa-header-1\",\n    title: \"Big Heading\"\n  },\n  \"heading-2\": {\n    name: \"heading-2\",\n    action: toggleHeading2,\n    className: \"fa fa-header fa-header-x fa-header-2\",\n    title: \"Medium Heading\"\n  },\n  \"heading-3\": {\n    name: \"heading-3\",\n    action: toggleHeading3,\n    className: \"fa fa-header fa-header-x fa-header-3\",\n    title: \"Small Heading\"\n  },\n  \"separator-1\": {\n    name: \"separator-1\"\n  },\n  \"code\": {\n    name: \"code\",\n    action: toggleCodeBlock,\n    className: \"fa fa-code\",\n    title: \"Code\"\n  },\n  \"quote\": {\n    name: \"quote\",\n    action: toggleBlockquote,\n    className: \"fa fa-quote-left\",\n    title: \"Quote\",\n    default: true\n  },\n  \"unordered-list\": {\n    name: \"unordered-list\",\n    action: toggleUnorderedList,\n    className: \"fa fa-list-ul\",\n    title: \"Generic List\",\n    default: true\n  },\n  \"ordered-list\": {\n    name: \"ordered-list\",\n    action: toggleOrderedList,\n    className: \"fa fa-list-ol\",\n    title: \"Numbered List\",\n    default: true\n  },\n  \"clean-block\": {\n    name: \"clean-block\",\n    action: cleanBlock,\n    className: \"fa fa-eraser fa-clean-block\",\n    title: \"Clean block\"\n  },\n  \"separator-2\": {\n    name: \"separator-2\"\n  },\n  \"link\": {\n    name: \"link\",\n    action: drawLink,\n    className: \"fa fa-link\",\n    title: \"Create Link\",\n    default: true\n  },\n  \"image\": {\n    name: \"image\",\n    action: drawImage,\n    className: \"fa fa-picture-o\",\n    title: \"Insert Image\",\n    default: true\n  },\n  \"table\": {\n    name: \"table\",\n    action: drawTable,\n    className: \"fa fa-table\",\n    title: \"Insert Table\"\n  },\n  \"horizontal-rule\": {\n    name: \"horizontal-rule\",\n    action: drawHorizontalRule,\n    className: \"fa fa-minus\",\n    title: \"Insert Horizontal Line\"\n  },\n  \"separator-3\": {\n    name: \"separator-3\"\n  },\n  \"preview\": {\n    name: \"preview\",\n    action: togglePreview,\n    className: \"fa fa-eye no-disable\",\n    title: \"Toggle Preview\",\n    default: true\n  },\n  \"side-by-side\": {\n    name: \"side-by-side\",\n    action: toggleSideBySide,\n    className: \"fa fa-columns no-disable no-mobile\",\n    title: \"Toggle Side by Side\",\n    default: true\n  },\n  \"fullscreen\": {\n    name: \"fullscreen\",\n    action: toggleFullScreen,\n    className: \"fa fa-arrows-alt no-disable no-mobile\",\n    title: \"Toggle Fullscreen\",\n    default: true\n  },\n  \"separator-4\": {\n    name: \"separator-4\"\n  },\n  \"guide\": {\n    name: \"guide\",\n    action: \"https://simplemde.com/markdown-guide\",\n    className: \"fa fa-question-circle\",\n    title: \"Markdown Guide\",\n    default: true\n  },\n  \"separator-5\": {\n    name: \"separator-5\"\n  },\n  \"undo\": {\n    name: \"undo\",\n    action: undo,\n    className: \"fa fa-undo no-disable\",\n    title: \"Undo\"\n  },\n  \"redo\": {\n    name: \"redo\",\n    action: redo,\n    className: \"fa fa-repeat no-disable\",\n    title: \"Redo\"\n  }\n};\nvar insertTexts = {\n  link: [\"[\", \"](#url#)\"],\n  image: [\"![](\", \"#url#)\"],\n  table: [\"\", \"\\n\\n| Column 1 | Column 2 | Column 3 |\\n| -------- | -------- | -------- |\\n| Text     | Text     | Text     |\\n\\n\"],\n  horizontalRule: [\"\", \"\\n\\n-----\\n\\n\"]\n};\nvar promptTexts = {\n  link: \"URL for the link:\",\n  image: \"URL of the image:\"\n};\nvar blockStyles = {\n  \"bold\": \"**\",\n  \"code\": \"```\",\n  \"italic\": \"*\"\n};\n/**\n * Interface of SimpleMDE.\n */\n\nfunction SimpleMDE(options) {\n  // Handle options parameter\n  options = options || {}; // Used later to refer to it\"s parent\n\n  options.parent = this; // Check if Font Awesome needs to be auto downloaded\n\n  var autoDownloadFA = true;\n\n  if (options.autoDownloadFontAwesome === false) {\n    autoDownloadFA = false;\n  }\n\n  if (options.autoDownloadFontAwesome !== true) {\n    var styleSheets = document.styleSheets;\n\n    for (var i = 0; i < styleSheets.length; i++) {\n      if (!styleSheets[i].href) continue;\n\n      if (styleSheets[i].href.indexOf(\"//maxcdn.bootstrapcdn.com/font-awesome/\") > -1) {\n        autoDownloadFA = false;\n      }\n    }\n  }\n\n  if (autoDownloadFA) {\n    var link = document.createElement(\"link\");\n    link.rel = \"stylesheet\";\n    link.href = \"https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css\";\n    document.getElementsByTagName(\"head\")[0].appendChild(link);\n  } // Find the textarea to use\n\n\n  if (options.element) {\n    this.element = options.element;\n  } else if (options.element === null) {\n    // This means that the element option was specified, but no element was found\n    console.log(\"SimpleMDE: Error. No element was found.\");\n    return;\n  } // Handle toolbar\n\n\n  if (options.toolbar === undefined) {\n    // Initialize\n    options.toolbar = []; // Loop over the built in buttons, to get the preferred order\n\n    for (var key in toolbarBuiltInButtons) {\n      if (toolbarBuiltInButtons.hasOwnProperty(key)) {\n        if (key.indexOf(\"separator-\") != -1) {\n          options.toolbar.push(\"|\");\n        }\n\n        if (toolbarBuiltInButtons[key].default === true || options.showIcons && options.showIcons.constructor === Array && options.showIcons.indexOf(key) != -1) {\n          options.toolbar.push(key);\n        }\n      }\n    }\n  } // Handle status bar\n\n\n  if (!options.hasOwnProperty(\"status\")) {\n    options.status = [\"autosave\", \"lines\", \"words\", \"cursor\"];\n  } // Add default preview rendering function\n\n\n  if (!options.previewRender) {\n    options.previewRender = function (plainText) {\n      // Note: \"this\" refers to the options object\n      return this.parent.markdown(plainText);\n    };\n  } // Set default options for parsing config\n\n\n  options.parsingConfig = extend({\n    highlightFormatting: true // needed for toggleCodeBlock to detect types of code\n\n  }, options.parsingConfig || {}); // Merging the insertTexts, with the given options\n\n  options.insertTexts = extend({}, insertTexts, options.insertTexts || {}); // Merging the promptTexts, with the given options\n\n  options.promptTexts = promptTexts; // Merging the blockStyles, with the given options\n\n  options.blockStyles = extend({}, blockStyles, options.blockStyles || {}); // Merging the shortcuts, with the given options\n\n  options.shortcuts = extend({}, shortcuts, options.shortcuts || {}); // Change unique_id to uniqueId for backwards compatibility\n\n  if (options.autosave != undefined && options.autosave.unique_id != undefined && options.autosave.unique_id != \"\") options.autosave.uniqueId = options.autosave.unique_id; // Update this options\n\n  this.options = options; // Auto render\n\n  this.render(); // The codemirror component is only available after rendering\n  // so, the setter for the initialValue can only run after\n  // the element has been rendered\n\n  if (options.initialValue && (!this.options.autosave || this.options.autosave.foundSavedValue !== true)) {\n    this.value(options.initialValue);\n  }\n}\n/**\n * Default markdown render.\n */\n\n\nSimpleMDE.prototype.markdown = function (text) {\n  if (marked) {\n    // Initialize\n    var markedOptions = {}; // Update options\n\n    if (this.options && this.options.renderingConfig && this.options.renderingConfig.singleLineBreaks === false) {\n      markedOptions.breaks = false;\n    } else {\n      markedOptions.breaks = true;\n    }\n\n    if (this.options && this.options.renderingConfig && this.options.renderingConfig.codeSyntaxHighlighting === true && window.hljs) {\n      markedOptions.highlight = function (code) {\n        return window.hljs.highlightAuto(code).value;\n      };\n    } // Set options\n\n\n    marked.setOptions(markedOptions); // Return\n\n    return marked(text);\n  }\n};\n/**\n * Render editor to the given element.\n */\n\n\nSimpleMDE.prototype.render = function (el) {\n  if (!el) {\n    el = this.element || document.getElementsByTagName(\"textarea\")[0];\n  }\n\n  if (this._rendered && this._rendered === el) {\n    // Already rendered.\n    return;\n  }\n\n  this.element = el;\n  var options = this.options;\n  var self = this;\n  var keyMaps = {};\n\n  for (var key in options.shortcuts) {\n    // null stands for \"do not bind this command\"\n    if (options.shortcuts[key] !== null && bindings[key] !== null) {\n      (function (key) {\n        keyMaps[fixShortcut(options.shortcuts[key])] = function () {\n          bindings[key](self);\n        };\n      })(key);\n    }\n  }\n\n  keyMaps[\"Enter\"] = \"newlineAndIndentContinueMarkdownList\";\n  keyMaps[\"Tab\"] = \"tabAndIndentMarkdownList\";\n  keyMaps[\"Shift-Tab\"] = \"shiftTabAndUnindentMarkdownList\";\n\n  keyMaps[\"Esc\"] = function (cm) {\n    if (cm.getOption(\"fullScreen\")) toggleFullScreen(self);\n  };\n\n  document.addEventListener(\"keydown\", function (e) {\n    e = e || window.event;\n\n    if (e.keyCode == 27) {\n      if (self.codemirror.getOption(\"fullScreen\")) toggleFullScreen(self);\n    }\n  }, false);\n  var mode, backdrop;\n\n  if (options.spellChecker !== false) {\n    mode = \"spell-checker\";\n    backdrop = options.parsingConfig;\n    backdrop.name = \"gfm\";\n    backdrop.gitHubSpice = false;\n    CodeMirrorSpellChecker({\n      codeMirrorInstance: CodeMirror\n    });\n  } else {\n    mode = options.parsingConfig;\n    mode.name = \"gfm\";\n    mode.gitHubSpice = false;\n  }\n\n  this.codemirror = CodeMirror.fromTextArea(el, {\n    mode: mode,\n    backdrop: backdrop,\n    theme: \"paper\",\n    tabSize: options.tabSize != undefined ? options.tabSize : 2,\n    indentUnit: options.tabSize != undefined ? options.tabSize : 2,\n    indentWithTabs: options.indentWithTabs === false ? false : true,\n    lineNumbers: false,\n    autofocus: options.autofocus === true ? true : false,\n    extraKeys: keyMaps,\n    lineWrapping: options.lineWrapping === false ? false : true,\n    allowDropFileTypes: [\"text/plain\"],\n    placeholder: options.placeholder || el.getAttribute(\"placeholder\") || \"\",\n    styleSelectedText: options.styleSelectedText != undefined ? options.styleSelectedText : true\n  });\n\n  if (options.forceSync === true) {\n    var cm = this.codemirror;\n    cm.on(\"change\", function () {\n      cm.save();\n    });\n  }\n\n  this.gui = {};\n\n  if (options.toolbar !== false) {\n    this.gui.toolbar = this.createToolbar();\n  }\n\n  if (options.status !== false) {\n    this.gui.statusbar = this.createStatusbar();\n  }\n\n  if (options.autosave != undefined && options.autosave.enabled === true) {\n    this.autosave();\n  }\n\n  this.gui.sideBySide = this.createSideBySide();\n  this._rendered = this.element; // Fixes CodeMirror bug (#344)\n\n  var temp_cm = this.codemirror;\n  setTimeout(function () {\n    temp_cm.refresh();\n  }.bind(temp_cm), 0);\n}; // Safari, in Private Browsing Mode, looks like it supports localStorage but all calls to setItem throw QuotaExceededError. We're going to detect this and set a variable accordingly.\n\n\nfunction isLocalStorageAvailable() {\n  if (typeof localStorage === \"object\") {\n    try {\n      localStorage.setItem(\"smde_localStorage\", 1);\n      localStorage.removeItem(\"smde_localStorage\");\n    } catch (e) {\n      return false;\n    }\n  } else {\n    return false;\n  }\n\n  return true;\n}\n\nSimpleMDE.prototype.autosave = function () {\n  if (isLocalStorageAvailable()) {\n    var simplemde = this;\n\n    if (this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == \"\") {\n      console.log(\"SimpleMDE: You must set a uniqueId to use the autosave feature\");\n      return;\n    }\n\n    if (simplemde.element.form != null && simplemde.element.form != undefined) {\n      simplemde.element.form.addEventListener(\"submit\", function () {\n        localStorage.removeItem(\"smde_\" + simplemde.options.autosave.uniqueId);\n      });\n    }\n\n    if (this.options.autosave.loaded !== true) {\n      if (typeof localStorage.getItem(\"smde_\" + this.options.autosave.uniqueId) == \"string\" && localStorage.getItem(\"smde_\" + this.options.autosave.uniqueId) != \"\") {\n        this.codemirror.setValue(localStorage.getItem(\"smde_\" + this.options.autosave.uniqueId));\n        this.options.autosave.foundSavedValue = true;\n      }\n\n      this.options.autosave.loaded = true;\n    }\n\n    localStorage.setItem(\"smde_\" + this.options.autosave.uniqueId, simplemde.value());\n    var el = document.getElementById(\"autosaved\");\n\n    if (el != null && el != undefined && el != \"\") {\n      var d = new Date();\n      var hh = d.getHours();\n      var m = d.getMinutes();\n      var dd = \"am\";\n      var h = hh;\n\n      if (h >= 12) {\n        h = hh - 12;\n        dd = \"pm\";\n      }\n\n      if (h == 0) {\n        h = 12;\n      }\n\n      m = m < 10 ? \"0\" + m : m;\n      el.innerHTML = \"Autosaved: \" + h + \":\" + m + \" \" + dd;\n    }\n\n    this.autosaveTimeoutId = setTimeout(function () {\n      simplemde.autosave();\n    }, this.options.autosave.delay || 10000);\n  } else {\n    console.log(\"SimpleMDE: localStorage not available, cannot autosave\");\n  }\n};\n\nSimpleMDE.prototype.clearAutosavedValue = function () {\n  if (isLocalStorageAvailable()) {\n    if (this.options.autosave == undefined || this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == \"\") {\n      console.log(\"SimpleMDE: You must set a uniqueId to clear the autosave value\");\n      return;\n    }\n\n    localStorage.removeItem(\"smde_\" + this.options.autosave.uniqueId);\n  } else {\n    console.log(\"SimpleMDE: localStorage not available, cannot autosave\");\n  }\n};\n\nSimpleMDE.prototype.createSideBySide = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n\n  if (!preview || !/editor-preview-side/.test(preview.className)) {\n    preview = document.createElement(\"div\");\n    preview.className = \"editor-preview-side\";\n    wrapper.parentNode.insertBefore(preview, wrapper.nextSibling);\n  } // Syncs scroll  editor -> preview\n\n\n  var cScroll = false;\n  var pScroll = false;\n  cm.on(\"scroll\", function (v) {\n    if (cScroll) {\n      cScroll = false;\n      return;\n    }\n\n    pScroll = true;\n    var height = v.getScrollInfo().height - v.getScrollInfo().clientHeight;\n    var ratio = parseFloat(v.getScrollInfo().top) / height;\n    var move = (preview.scrollHeight - preview.clientHeight) * ratio;\n    preview.scrollTop = move;\n  }); // Syncs scroll  preview -> editor\n\n  preview.onscroll = function () {\n    if (pScroll) {\n      pScroll = false;\n      return;\n    }\n\n    cScroll = true;\n    var height = preview.scrollHeight - preview.clientHeight;\n    var ratio = parseFloat(preview.scrollTop) / height;\n    var move = (cm.getScrollInfo().height - cm.getScrollInfo().clientHeight) * ratio;\n    cm.scrollTo(0, move);\n  };\n\n  return preview;\n};\n\nSimpleMDE.prototype.createToolbar = function (items) {\n  items = items || this.options.toolbar;\n\n  if (!items || items.length === 0) {\n    return;\n  }\n\n  var i;\n\n  for (i = 0; i < items.length; i++) {\n    if (toolbarBuiltInButtons[items[i]] != undefined) {\n      items[i] = toolbarBuiltInButtons[items[i]];\n    }\n  }\n\n  var bar = document.createElement(\"div\");\n  bar.className = \"editor-toolbar\";\n  var self = this;\n  var toolbarData = {};\n  self.toolbar = items;\n\n  for (i = 0; i < items.length; i++) {\n    if (items[i].name == \"guide\" && self.options.toolbarGuideIcon === false) continue;\n    if (self.options.hideIcons && self.options.hideIcons.indexOf(items[i].name) != -1) continue; // Fullscreen does not work well on mobile devices (even tablets)\n    // In the future, hopefully this can be resolved\n\n    if ((items[i].name == \"fullscreen\" || items[i].name == \"side-by-side\") && isMobile()) continue; // Don't include trailing separators\n\n    if (items[i] === \"|\") {\n      var nonSeparatorIconsFollow = false;\n\n      for (var x = i + 1; x < items.length; x++) {\n        if (items[x] !== \"|\" && (!self.options.hideIcons || self.options.hideIcons.indexOf(items[x].name) == -1)) {\n          nonSeparatorIconsFollow = true;\n        }\n      }\n\n      if (!nonSeparatorIconsFollow) continue;\n    } // Create the icon and append to the toolbar\n\n\n    (function (item) {\n      var el;\n\n      if (item === \"|\") {\n        el = createSep();\n      } else {\n        el = createIcon(item, self.options.toolbarTips, self.options.shortcuts);\n      } // bind events, special for info\n\n\n      if (item.action) {\n        if (typeof item.action === \"function\") {\n          el.onclick = function (e) {\n            e.preventDefault();\n            item.action(self);\n          };\n        } else if (typeof item.action === \"string\") {\n          el.href = item.action;\n          el.target = \"_blank\";\n        }\n      }\n\n      toolbarData[item.name || item] = el;\n      bar.appendChild(el);\n    })(items[i]);\n  }\n\n  self.toolbarElements = toolbarData;\n  var cm = this.codemirror;\n  cm.on(\"cursorActivity\", function () {\n    var stat = getState(cm);\n\n    for (var key in toolbarData) {\n      (function (key) {\n        var el = toolbarData[key];\n\n        if (stat[key]) {\n          el.className += \" active\";\n        } else if (key != \"fullscreen\" && key != \"side-by-side\") {\n          el.className = el.className.replace(/\\s*active\\s*/g, \"\");\n        }\n      })(key);\n    }\n  });\n  var cmWrapper = cm.getWrapperElement();\n  cmWrapper.parentNode.insertBefore(bar, cmWrapper);\n  return bar;\n};\n\nSimpleMDE.prototype.createStatusbar = function (status) {\n  // Initialize\n  status = status || this.options.status;\n  var options = this.options;\n  var cm = this.codemirror; // Make sure the status variable is valid\n\n  if (!status || status.length === 0) return; // Set up the built-in items\n\n  var items = [];\n  var i, onUpdate, defaultValue;\n\n  for (i = 0; i < status.length; i++) {\n    // Reset some values\n    onUpdate = undefined;\n    defaultValue = undefined; // Handle if custom or not\n\n    if (typeof status[i] === \"object\") {\n      items.push({\n        className: status[i].className,\n        defaultValue: status[i].defaultValue,\n        onUpdate: status[i].onUpdate\n      });\n    } else {\n      var name = status[i];\n\n      if (name === \"words\") {\n        defaultValue = function (el) {\n          el.innerHTML = wordCount(cm.getValue());\n        };\n\n        onUpdate = function (el) {\n          el.innerHTML = wordCount(cm.getValue());\n        };\n      } else if (name === \"lines\") {\n        defaultValue = function (el) {\n          el.innerHTML = cm.lineCount();\n        };\n\n        onUpdate = function (el) {\n          el.innerHTML = cm.lineCount();\n        };\n      } else if (name === \"cursor\") {\n        defaultValue = function (el) {\n          el.innerHTML = \"0:0\";\n        };\n\n        onUpdate = function (el) {\n          var pos = cm.getCursor();\n          el.innerHTML = pos.line + \":\" + pos.ch;\n        };\n      } else if (name === \"autosave\") {\n        defaultValue = function (el) {\n          if (options.autosave != undefined && options.autosave.enabled === true) {\n            el.setAttribute(\"id\", \"autosaved\");\n          }\n        };\n      }\n\n      items.push({\n        className: name,\n        defaultValue: defaultValue,\n        onUpdate: onUpdate\n      });\n    }\n  } // Create element for the status bar\n\n\n  var bar = document.createElement(\"div\");\n  bar.className = \"editor-statusbar\"; // Create a new span for each item\n\n  for (i = 0; i < items.length; i++) {\n    // Store in temporary variable\n    var item = items[i]; // Create span element\n\n    var el = document.createElement(\"span\");\n    el.className = item.className; // Ensure the defaultValue is a function\n\n    if (typeof item.defaultValue === \"function\") {\n      item.defaultValue(el);\n    } // Ensure the onUpdate is a function\n\n\n    if (typeof item.onUpdate === \"function\") {\n      // Create a closure around the span of the current action, then execute the onUpdate handler\n      this.codemirror.on(\"update\", function (el, item) {\n        return function () {\n          item.onUpdate(el);\n        };\n      }(el, item));\n    } // Append the item to the status bar\n\n\n    bar.appendChild(el);\n  } // Insert the status bar into the DOM\n\n\n  var cmWrapper = this.codemirror.getWrapperElement();\n  cmWrapper.parentNode.insertBefore(bar, cmWrapper.nextSibling);\n  return bar;\n};\n/**\n * Get or set the text content.\n */\n\n\nSimpleMDE.prototype.value = function (val) {\n  if (val === undefined) {\n    return this.codemirror.getValue();\n  } else {\n    this.codemirror.getDoc().setValue(val);\n    return this;\n  }\n};\n/**\n * Bind static methods for exports.\n */\n\n\nSimpleMDE.toggleBold = toggleBold;\nSimpleMDE.toggleItalic = toggleItalic;\nSimpleMDE.toggleStrikethrough = toggleStrikethrough;\nSimpleMDE.toggleBlockquote = toggleBlockquote;\nSimpleMDE.toggleHeadingSmaller = toggleHeadingSmaller;\nSimpleMDE.toggleHeadingBigger = toggleHeadingBigger;\nSimpleMDE.toggleHeading1 = toggleHeading1;\nSimpleMDE.toggleHeading2 = toggleHeading2;\nSimpleMDE.toggleHeading3 = toggleHeading3;\nSimpleMDE.toggleCodeBlock = toggleCodeBlock;\nSimpleMDE.toggleUnorderedList = toggleUnorderedList;\nSimpleMDE.toggleOrderedList = toggleOrderedList;\nSimpleMDE.cleanBlock = cleanBlock;\nSimpleMDE.drawLink = drawLink;\nSimpleMDE.drawImage = drawImage;\nSimpleMDE.drawTable = drawTable;\nSimpleMDE.drawHorizontalRule = drawHorizontalRule;\nSimpleMDE.undo = undo;\nSimpleMDE.redo = redo;\nSimpleMDE.togglePreview = togglePreview;\nSimpleMDE.toggleSideBySide = toggleSideBySide;\nSimpleMDE.toggleFullScreen = toggleFullScreen;\n/**\n * Bind instance methods for exports.\n */\n\nSimpleMDE.prototype.toggleBold = function () {\n  toggleBold(this);\n};\n\nSimpleMDE.prototype.toggleItalic = function () {\n  toggleItalic(this);\n};\n\nSimpleMDE.prototype.toggleStrikethrough = function () {\n  toggleStrikethrough(this);\n};\n\nSimpleMDE.prototype.toggleBlockquote = function () {\n  toggleBlockquote(this);\n};\n\nSimpleMDE.prototype.toggleHeadingSmaller = function () {\n  toggleHeadingSmaller(this);\n};\n\nSimpleMDE.prototype.toggleHeadingBigger = function () {\n  toggleHeadingBigger(this);\n};\n\nSimpleMDE.prototype.toggleHeading1 = function () {\n  toggleHeading1(this);\n};\n\nSimpleMDE.prototype.toggleHeading2 = function () {\n  toggleHeading2(this);\n};\n\nSimpleMDE.prototype.toggleHeading3 = function () {\n  toggleHeading3(this);\n};\n\nSimpleMDE.prototype.toggleCodeBlock = function () {\n  toggleCodeBlock(this);\n};\n\nSimpleMDE.prototype.toggleUnorderedList = function () {\n  toggleUnorderedList(this);\n};\n\nSimpleMDE.prototype.toggleOrderedList = function () {\n  toggleOrderedList(this);\n};\n\nSimpleMDE.prototype.cleanBlock = function () {\n  cleanBlock(this);\n};\n\nSimpleMDE.prototype.drawLink = function () {\n  drawLink(this);\n};\n\nSimpleMDE.prototype.drawImage = function () {\n  drawImage(this);\n};\n\nSimpleMDE.prototype.drawTable = function () {\n  drawTable(this);\n};\n\nSimpleMDE.prototype.drawHorizontalRule = function () {\n  drawHorizontalRule(this);\n};\n\nSimpleMDE.prototype.undo = function () {\n  undo(this);\n};\n\nSimpleMDE.prototype.redo = function () {\n  redo(this);\n};\n\nSimpleMDE.prototype.togglePreview = function () {\n  togglePreview(this);\n};\n\nSimpleMDE.prototype.toggleSideBySide = function () {\n  toggleSideBySide(this);\n};\n\nSimpleMDE.prototype.toggleFullScreen = function () {\n  toggleFullScreen(this);\n};\n\nSimpleMDE.prototype.isPreviewActive = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.lastChild;\n  return /editor-preview-active/.test(preview.className);\n};\n\nSimpleMDE.prototype.isSideBySideActive = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n  var preview = wrapper.nextSibling;\n  return /editor-preview-active-side/.test(preview.className);\n};\n\nSimpleMDE.prototype.isFullscreenActive = function () {\n  var cm = this.codemirror;\n  return cm.getOption(\"fullScreen\");\n};\n\nSimpleMDE.prototype.getState = function () {\n  var cm = this.codemirror;\n  return getState(cm);\n};\n\nSimpleMDE.prototype.toTextArea = function () {\n  var cm = this.codemirror;\n  var wrapper = cm.getWrapperElement();\n\n  if (wrapper.parentNode) {\n    if (this.gui.toolbar) {\n      wrapper.parentNode.removeChild(this.gui.toolbar);\n    }\n\n    if (this.gui.statusbar) {\n      wrapper.parentNode.removeChild(this.gui.statusbar);\n    }\n\n    if (this.gui.sideBySide) {\n      wrapper.parentNode.removeChild(this.gui.sideBySide);\n    }\n  }\n\n  cm.toTextArea();\n\n  if (this.autosaveTimeoutId) {\n    clearTimeout(this.autosaveTimeoutId);\n    this.autosaveTimeoutId = undefined;\n    this.clearAutosavedValue();\n  }\n};\n\nmodule.exports = SimpleMDE;","map":{"version":3,"sources":["C:/Users/yangwei/Desktop/my-app/my-app/my-demo/node_modules/simplemde/src/js/simplemde.js"],"names":["CodeMirror","require","CodeMirrorSpellChecker","marked","isMac","test","navigator","platform","bindings","toggleBold","toggleItalic","drawLink","toggleHeadingSmaller","toggleHeadingBigger","drawImage","toggleBlockquote","toggleOrderedList","toggleUnorderedList","toggleCodeBlock","togglePreview","toggleStrikethrough","toggleHeading1","toggleHeading2","toggleHeading3","cleanBlock","drawTable","drawHorizontalRule","undo","redo","toggleSideBySide","toggleFullScreen","shortcuts","getBindingName","f","key","isMobile","check","a","substr","userAgent","vendor","window","opera","fixShortcut","name","replace","createIcon","options","enableTooltips","el","document","createElement","undefined","title","createTootlip","action","tabIndex","className","createSep","innerHTML","actionName","tooltip","getState","cm","pos","getCursor","stat","getTokenAt","type","types","split","ret","data","text","i","length","bold","getLine","line","quote","italic","strikethrough","code","link","image","match","saved_overflow","editor","codemirror","setOption","getOption","body","style","overflow","wrap","getWrapperElement","previousSibling","toolbarButton","toolbarElements","fullscreen","sidebyside","nextSibling","_toggleBlock","blockStyles","fenceCharsToInsert","fencing_line","styles","indexOf","token_state","token","state","base","code_type","line_num","firstTok","lastTok","getLineHandle","ch","indentedCode","fencedChars","insertFencingAtSelection","cur_start","cur_end","start_line_sel","end_line_sel","sel_multi","repl_start","repl_end","_replaceSelection","setSelection","tok","is_code","block_start","block_end","lineCount","start","slice","end","replaceRange","focus","fencedTok","fence_chars","start_text","start_line","end_text","end_line","operation","search_from","next_line","next_line_last_tok","next_line_indented","indentLine","no_sel_and_starting_of_line","_toggleLine","_toggleHeading","_cleanBlock","url","promptURLs","prompt","promptTexts","insertTexts","table","horizontalRule","wrapper","preview","useSideBySideListener","setTimeout","previewNormal","lastChild","toolbar","toolbar_div","sideBySideRenderingFunction","previewRender","value","on","off","refresh","appendChild","active","startEnd","startPoint","endPoint","getSelection","replaceSelection","direction","size","currHeadingLevel","search","repl","map","start_chars","end_chars","join","_mergeProperties","target","source","property","hasOwnProperty","Array","concat","constructor","Object","extend","arguments","wordCount","pattern","m","count","charCodeAt","toolbarBuiltInButtons","default","SimpleMDE","parent","autoDownloadFA","autoDownloadFontAwesome","styleSheets","href","rel","getElementsByTagName","element","console","log","push","showIcons","status","plainText","markdown","parsingConfig","highlightFormatting","autosave","unique_id","uniqueId","render","initialValue","foundSavedValue","prototype","markedOptions","renderingConfig","singleLineBreaks","breaks","codeSyntaxHighlighting","hljs","highlight","highlightAuto","setOptions","_rendered","self","keyMaps","addEventListener","e","event","keyCode","mode","backdrop","spellChecker","gitHubSpice","codeMirrorInstance","fromTextArea","theme","tabSize","indentUnit","indentWithTabs","lineNumbers","autofocus","extraKeys","lineWrapping","allowDropFileTypes","placeholder","getAttribute","styleSelectedText","forceSync","save","gui","createToolbar","statusbar","createStatusbar","enabled","sideBySide","createSideBySide","temp_cm","bind","isLocalStorageAvailable","localStorage","setItem","removeItem","simplemde","form","loaded","getItem","setValue","getElementById","d","Date","hh","getHours","getMinutes","dd","h","autosaveTimeoutId","delay","clearAutosavedValue","parentNode","insertBefore","cScroll","pScroll","v","height","getScrollInfo","clientHeight","ratio","parseFloat","top","move","scrollHeight","scrollTop","onscroll","scrollTo","items","bar","toolbarData","toolbarGuideIcon","hideIcons","nonSeparatorIconsFollow","x","item","toolbarTips","onclick","preventDefault","cmWrapper","onUpdate","defaultValue","getValue","setAttribute","val","getDoc","isPreviewActive","isSideBySideActive","isFullscreenActive","toTextArea","removeChild","clearTimeout","module","exports"],"mappings":"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","sourcesContent":["/*global require,module*/\n\"use strict\";\nvar CodeMirror = require(\"codemirror\");\nrequire(\"codemirror/addon/edit/continuelist.js\");\nrequire(\"./codemirror/tablist\");\nrequire(\"codemirror/addon/display/fullscreen.js\");\nrequire(\"codemirror/mode/markdown/markdown.js\");\nrequire(\"codemirror/addon/mode/overlay.js\");\nrequire(\"codemirror/addon/display/placeholder.js\");\nrequire(\"codemirror/addon/selection/mark-selection.js\");\nrequire(\"codemirror/mode/gfm/gfm.js\");\nrequire(\"codemirror/mode/xml/xml.js\");\nvar CodeMirrorSpellChecker = require(\"codemirror-spell-checker\");\nvar marked = require(\"marked\");\n\n\n// Some variables\nvar isMac = /Mac/.test(navigator.platform);\n\n// Mapping of actions that can be bound to keyboard shortcuts or toolbar buttons\nvar bindings = {\n\t\"toggleBold\": toggleBold,\n\t\"toggleItalic\": toggleItalic,\n\t\"drawLink\": drawLink,\n\t\"toggleHeadingSmaller\": toggleHeadingSmaller,\n\t\"toggleHeadingBigger\": toggleHeadingBigger,\n\t\"drawImage\": drawImage,\n\t\"toggleBlockquote\": toggleBlockquote,\n\t\"toggleOrderedList\": toggleOrderedList,\n\t\"toggleUnorderedList\": toggleUnorderedList,\n\t\"toggleCodeBlock\": toggleCodeBlock,\n\t\"togglePreview\": togglePreview,\n\t\"toggleStrikethrough\": toggleStrikethrough,\n\t\"toggleHeading1\": toggleHeading1,\n\t\"toggleHeading2\": toggleHeading2,\n\t\"toggleHeading3\": toggleHeading3,\n\t\"cleanBlock\": cleanBlock,\n\t\"drawTable\": drawTable,\n\t\"drawHorizontalRule\": drawHorizontalRule,\n\t\"undo\": undo,\n\t\"redo\": redo,\n\t\"toggleSideBySide\": toggleSideBySide,\n\t\"toggleFullScreen\": toggleFullScreen\n};\n\nvar shortcuts = {\n\t\"toggleBold\": \"Cmd-B\",\n\t\"toggleItalic\": \"Cmd-I\",\n\t\"drawLink\": \"Cmd-K\",\n\t\"toggleHeadingSmaller\": \"Cmd-H\",\n\t\"toggleHeadingBigger\": \"Shift-Cmd-H\",\n\t\"cleanBlock\": \"Cmd-E\",\n\t\"drawImage\": \"Cmd-Alt-I\",\n\t\"toggleBlockquote\": \"Cmd-'\",\n\t\"toggleOrderedList\": \"Cmd-Alt-L\",\n\t\"toggleUnorderedList\": \"Cmd-L\",\n\t\"toggleCodeBlock\": \"Cmd-Alt-C\",\n\t\"togglePreview\": \"Cmd-P\",\n\t\"toggleSideBySide\": \"F9\",\n\t\"toggleFullScreen\": \"F11\"\n};\n\nvar getBindingName = function(f) {\n\tfor(var key in bindings) {\n\t\tif(bindings[key] === f) {\n\t\t\treturn key;\n\t\t}\n\t}\n\treturn null;\n};\n\nvar isMobile = function() {\n\tvar check = false;\n\t(function(a) {\n\t\tif(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true;\n\t})(navigator.userAgent || navigator.vendor || window.opera);\n\treturn check;\n};\n\n\n/**\n * Fix shortcut. Mac use Command, others use Ctrl.\n */\nfunction fixShortcut(name) {\n\tif(isMac) {\n\t\tname = name.replace(\"Ctrl\", \"Cmd\");\n\t} else {\n\t\tname = name.replace(\"Cmd\", \"Ctrl\");\n\t}\n\treturn name;\n}\n\n\n/**\n * Create icon element for toolbar.\n */\nfunction createIcon(options, enableTooltips, shortcuts) {\n\toptions = options || {};\n\tvar el = document.createElement(\"a\");\n\tenableTooltips = (enableTooltips == undefined) ? true : enableTooltips;\n\n\tif(options.title && enableTooltips) {\n\t\tel.title = createTootlip(options.title, options.action, shortcuts);\n\n\t\tif(isMac) {\n\t\t\tel.title = el.title.replace(\"Ctrl\", \"⌘\");\n\t\t\tel.title = el.title.replace(\"Alt\", \"⌥\");\n\t\t}\n\t}\n\n\tel.tabIndex = -1;\n\tel.className = options.className;\n\treturn el;\n}\n\nfunction createSep() {\n\tvar el = document.createElement(\"i\");\n\tel.className = \"separator\";\n\tel.innerHTML = \"|\";\n\treturn el;\n}\n\nfunction createTootlip(title, action, shortcuts) {\n\tvar actionName;\n\tvar tooltip = title;\n\n\tif(action) {\n\t\tactionName = getBindingName(action);\n\t\tif(shortcuts[actionName]) {\n\t\t\ttooltip += \" (\" + fixShortcut(shortcuts[actionName]) + \")\";\n\t\t}\n\t}\n\n\treturn tooltip;\n}\n\n/**\n * The state of CodeMirror at the given position.\n */\nfunction getState(cm, pos) {\n\tpos = pos || cm.getCursor(\"start\");\n\tvar stat = cm.getTokenAt(pos);\n\tif(!stat.type) return {};\n\n\tvar types = stat.type.split(\" \");\n\n\tvar ret = {},\n\t\tdata, text;\n\tfor(var i = 0; i < types.length; i++) {\n\t\tdata = types[i];\n\t\tif(data === \"strong\") {\n\t\t\tret.bold = true;\n\t\t} else if(data === \"variable-2\") {\n\t\t\ttext = cm.getLine(pos.line);\n\t\t\tif(/^\\s*\\d+\\.\\s/.test(text)) {\n\t\t\t\tret[\"ordered-list\"] = true;\n\t\t\t} else {\n\t\t\t\tret[\"unordered-list\"] = true;\n\t\t\t}\n\t\t} else if(data === \"atom\") {\n\t\t\tret.quote = true;\n\t\t} else if(data === \"em\") {\n\t\t\tret.italic = true;\n\t\t} else if(data === \"quote\") {\n\t\t\tret.quote = true;\n\t\t} else if(data === \"strikethrough\") {\n\t\t\tret.strikethrough = true;\n\t\t} else if(data === \"comment\") {\n\t\t\tret.code = true;\n\t\t} else if(data === \"link\") {\n\t\t\tret.link = true;\n\t\t} else if(data === \"tag\") {\n\t\t\tret.image = true;\n\t\t} else if(data.match(/^header(\\-[1-6])?$/)) {\n\t\t\tret[data.replace(\"header\", \"heading\")] = true;\n\t\t}\n\t}\n\treturn ret;\n}\n\n\n// Saved overflow setting\nvar saved_overflow = \"\";\n\n/**\n * Toggle full screen of the editor.\n */\nfunction toggleFullScreen(editor) {\n\t// Set fullscreen\n\tvar cm = editor.codemirror;\n\tcm.setOption(\"fullScreen\", !cm.getOption(\"fullScreen\"));\n\n\n\t// Prevent scrolling on body during fullscreen active\n\tif(cm.getOption(\"fullScreen\")) {\n\t\tsaved_overflow = document.body.style.overflow;\n\t\tdocument.body.style.overflow = \"hidden\";\n\t} else {\n\t\tdocument.body.style.overflow = saved_overflow;\n\t}\n\n\n\t// Update toolbar class\n\tvar wrap = cm.getWrapperElement();\n\n\tif(!/fullscreen/.test(wrap.previousSibling.className)) {\n\t\twrap.previousSibling.className += \" fullscreen\";\n\t} else {\n\t\twrap.previousSibling.className = wrap.previousSibling.className.replace(/\\s*fullscreen\\b/, \"\");\n\t}\n\n\n\t// Update toolbar button\n\tvar toolbarButton = editor.toolbarElements.fullscreen;\n\n\tif(!/active/.test(toolbarButton.className)) {\n\t\ttoolbarButton.className += \" active\";\n\t} else {\n\t\ttoolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, \"\");\n\t}\n\n\n\t// Hide side by side if needed\n\tvar sidebyside = cm.getWrapperElement().nextSibling;\n\tif(/editor-preview-active-side/.test(sidebyside.className))\n\t\ttoggleSideBySide(editor);\n}\n\n\n/**\n * Action for toggling bold.\n */\nfunction toggleBold(editor) {\n\t_toggleBlock(editor, \"bold\", editor.options.blockStyles.bold);\n}\n\n\n/**\n * Action for toggling italic.\n */\nfunction toggleItalic(editor) {\n\t_toggleBlock(editor, \"italic\", editor.options.blockStyles.italic);\n}\n\n\n/**\n * Action for toggling strikethrough.\n */\nfunction toggleStrikethrough(editor) {\n\t_toggleBlock(editor, \"strikethrough\", \"~~\");\n}\n\n/**\n * Action for toggling code block.\n */\nfunction toggleCodeBlock(editor) {\n\tvar fenceCharsToInsert = editor.options.blockStyles.code;\n\n\tfunction fencing_line(line) {\n\t\t/* return true, if this is a ``` or ~~~ line */\n\t\tif(typeof line !== \"object\") {\n\t\t\tthrow \"fencing_line() takes a 'line' object (not a line number, or line text).  Got: \" + typeof line + \": \" + line;\n\t\t}\n\t\treturn line.styles && line.styles[2] && line.styles[2].indexOf(\"formatting-code-block\") !== -1;\n\t}\n\n\tfunction token_state(token) {\n\t\t// base goes an extra level deep when mode backdrops are used, e.g. spellchecker on\n\t\treturn token.state.base.base || token.state.base;\n\t}\n\n\tfunction code_type(cm, line_num, line, firstTok, lastTok) {\n\t\t/*\n\t\t * Return \"single\", \"indented\", \"fenced\" or false\n\t\t *\n\t\t * cm and line_num are required.  Others are optional for efficiency\n\t\t *   To check in the middle of a line, pass in firstTok yourself.\n\t\t */\n\t\tline = line || cm.getLineHandle(line_num);\n\t\tfirstTok = firstTok || cm.getTokenAt({\n\t\t\tline: line_num,\n\t\t\tch: 1\n\t\t});\n\t\tlastTok = lastTok || (!!line.text && cm.getTokenAt({\n\t\t\tline: line_num,\n\t\t\tch: line.text.length - 1\n\t\t}));\n\t\tvar types = firstTok.type ? firstTok.type.split(\" \") : [];\n\t\tif(lastTok && token_state(lastTok).indentedCode) {\n\t\t\t// have to check last char, since first chars of first line aren\"t marked as indented\n\t\t\treturn \"indented\";\n\t\t} else if(types.indexOf(\"comment\") === -1) {\n\t\t\t// has to be after \"indented\" check, since first chars of first indented line aren\"t marked as such\n\t\t\treturn false;\n\t\t} else if(token_state(firstTok).fencedChars || token_state(lastTok).fencedChars || fencing_line(line)) {\n\t\t\treturn \"fenced\";\n\t\t} else {\n\t\t\treturn \"single\";\n\t\t}\n\t}\n\n\tfunction insertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert) {\n\t\tvar start_line_sel = cur_start.line + 1,\n\t\t\tend_line_sel = cur_end.line + 1,\n\t\t\tsel_multi = cur_start.line !== cur_end.line,\n\t\t\trepl_start = fenceCharsToInsert + \"\\n\",\n\t\t\trepl_end = \"\\n\" + fenceCharsToInsert;\n\t\tif(sel_multi) {\n\t\t\tend_line_sel++;\n\t\t}\n\t\t// handle last char including \\n or not\n\t\tif(sel_multi && cur_end.ch === 0) {\n\t\t\trepl_end = fenceCharsToInsert + \"\\n\";\n\t\t\tend_line_sel--;\n\t\t}\n\t\t_replaceSelection(cm, false, [repl_start, repl_end]);\n\t\tcm.setSelection({\n\t\t\tline: start_line_sel,\n\t\t\tch: 0\n\t\t}, {\n\t\t\tline: end_line_sel,\n\t\t\tch: 0\n\t\t});\n\t}\n\n\tvar cm = editor.codemirror,\n\t\tcur_start = cm.getCursor(\"start\"),\n\t\tcur_end = cm.getCursor(\"end\"),\n\t\ttok = cm.getTokenAt({\n\t\t\tline: cur_start.line,\n\t\t\tch: cur_start.ch || 1\n\t\t}), // avoid ch 0 which is a cursor pos but not token\n\t\tline = cm.getLineHandle(cur_start.line),\n\t\tis_code = code_type(cm, cur_start.line, line, tok);\n\tvar block_start, block_end, lineCount;\n\n\tif(is_code === \"single\") {\n\t\t// similar to some SimpleMDE _toggleBlock logic\n\t\tvar start = line.text.slice(0, cur_start.ch).replace(\"`\", \"\"),\n\t\t\tend = line.text.slice(cur_start.ch).replace(\"`\", \"\");\n\t\tcm.replaceRange(start + end, {\n\t\t\tline: cur_start.line,\n\t\t\tch: 0\n\t\t}, {\n\t\t\tline: cur_start.line,\n\t\t\tch: 99999999999999\n\t\t});\n\t\tcur_start.ch--;\n\t\tif(cur_start !== cur_end) {\n\t\t\tcur_end.ch--;\n\t\t}\n\t\tcm.setSelection(cur_start, cur_end);\n\t\tcm.focus();\n\t} else if(is_code === \"fenced\") {\n\t\tif(cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n\t\t\t// use selection\n\n\t\t\t// find the fenced line so we know what type it is (tilde, backticks, number of them)\n\t\t\tfor(block_start = cur_start.line; block_start >= 0; block_start--) {\n\t\t\t\tline = cm.getLineHandle(block_start);\n\t\t\t\tif(fencing_line(line)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar fencedTok = cm.getTokenAt({\n\t\t\t\tline: block_start,\n\t\t\t\tch: 1\n\t\t\t});\n\t\t\tvar fence_chars = token_state(fencedTok).fencedChars;\n\t\t\tvar start_text, start_line;\n\t\t\tvar end_text, end_line;\n\t\t\t// check for selection going up against fenced lines, in which case we don't want to add more fencing\n\t\t\tif(fencing_line(cm.getLineHandle(cur_start.line))) {\n\t\t\t\tstart_text = \"\";\n\t\t\t\tstart_line = cur_start.line;\n\t\t\t} else if(fencing_line(cm.getLineHandle(cur_start.line - 1))) {\n\t\t\t\tstart_text = \"\";\n\t\t\t\tstart_line = cur_start.line - 1;\n\t\t\t} else {\n\t\t\t\tstart_text = fence_chars + \"\\n\";\n\t\t\t\tstart_line = cur_start.line;\n\t\t\t}\n\t\t\tif(fencing_line(cm.getLineHandle(cur_end.line))) {\n\t\t\t\tend_text = \"\";\n\t\t\t\tend_line = cur_end.line;\n\t\t\t\tif(cur_end.ch === 0) {\n\t\t\t\t\tend_line += 1;\n\t\t\t\t}\n\t\t\t} else if(cur_end.ch !== 0 && fencing_line(cm.getLineHandle(cur_end.line + 1))) {\n\t\t\t\tend_text = \"\";\n\t\t\t\tend_line = cur_end.line + 1;\n\t\t\t} else {\n\t\t\t\tend_text = fence_chars + \"\\n\";\n\t\t\t\tend_line = cur_end.line + 1;\n\t\t\t}\n\t\t\tif(cur_end.ch === 0) {\n\t\t\t\t// full last line selected, putting cursor at beginning of next\n\t\t\t\tend_line -= 1;\n\t\t\t}\n\t\t\tcm.operation(function() {\n\t\t\t\t// end line first, so that line numbers don't change\n\t\t\t\tcm.replaceRange(end_text, {\n\t\t\t\t\tline: end_line,\n\t\t\t\t\tch: 0\n\t\t\t\t}, {\n\t\t\t\t\tline: end_line + (end_text ? 0 : 1),\n\t\t\t\t\tch: 0\n\t\t\t\t});\n\t\t\t\tcm.replaceRange(start_text, {\n\t\t\t\t\tline: start_line,\n\t\t\t\t\tch: 0\n\t\t\t\t}, {\n\t\t\t\t\tline: start_line + (start_text ? 0 : 1),\n\t\t\t\t\tch: 0\n\t\t\t\t});\n\t\t\t});\n\t\t\tcm.setSelection({\n\t\t\t\tline: start_line + (start_text ? 1 : 0),\n\t\t\t\tch: 0\n\t\t\t}, {\n\t\t\t\tline: end_line + (start_text ? 1 : -1),\n\t\t\t\tch: 0\n\t\t\t});\n\t\t\tcm.focus();\n\t\t} else {\n\t\t\t// no selection, search for ends of this fenced block\n\t\t\tvar search_from = cur_start.line;\n\t\t\tif(fencing_line(cm.getLineHandle(cur_start.line))) { // gets a little tricky if cursor is right on a fenced line\n\t\t\t\tif(code_type(cm, cur_start.line + 1) === \"fenced\") {\n\t\t\t\t\tblock_start = cur_start.line;\n\t\t\t\t\tsearch_from = cur_start.line + 1; // for searching for \"end\"\n\t\t\t\t} else {\n\t\t\t\t\tblock_end = cur_start.line;\n\t\t\t\t\tsearch_from = cur_start.line - 1; // for searching for \"start\"\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(block_start === undefined) {\n\t\t\t\tfor(block_start = search_from; block_start >= 0; block_start--) {\n\t\t\t\t\tline = cm.getLineHandle(block_start);\n\t\t\t\t\tif(fencing_line(line)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(block_end === undefined) {\n\t\t\t\tlineCount = cm.lineCount();\n\t\t\t\tfor(block_end = search_from; block_end < lineCount; block_end++) {\n\t\t\t\t\tline = cm.getLineHandle(block_end);\n\t\t\t\t\tif(fencing_line(line)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcm.operation(function() {\n\t\t\t\tcm.replaceRange(\"\", {\n\t\t\t\t\tline: block_start,\n\t\t\t\t\tch: 0\n\t\t\t\t}, {\n\t\t\t\t\tline: block_start + 1,\n\t\t\t\t\tch: 0\n\t\t\t\t});\n\t\t\t\tcm.replaceRange(\"\", {\n\t\t\t\t\tline: block_end - 1,\n\t\t\t\t\tch: 0\n\t\t\t\t}, {\n\t\t\t\t\tline: block_end,\n\t\t\t\t\tch: 0\n\t\t\t\t});\n\t\t\t});\n\t\t\tcm.focus();\n\t\t}\n\t} else if(is_code === \"indented\") {\n\t\tif(cur_start.line !== cur_end.line || cur_start.ch !== cur_end.ch) {\n\t\t\t// use selection\n\t\t\tblock_start = cur_start.line;\n\t\t\tblock_end = cur_end.line;\n\t\t\tif(cur_end.ch === 0) {\n\t\t\t\tblock_end--;\n\t\t\t}\n\t\t} else {\n\t\t\t// no selection, search for ends of this indented block\n\t\t\tfor(block_start = cur_start.line; block_start >= 0; block_start--) {\n\t\t\t\tline = cm.getLineHandle(block_start);\n\t\t\t\tif(line.text.match(/^\\s*$/)) {\n\t\t\t\t\t// empty or all whitespace - keep going\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tif(code_type(cm, block_start, line) !== \"indented\") {\n\t\t\t\t\t\tblock_start += 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlineCount = cm.lineCount();\n\t\t\tfor(block_end = cur_start.line; block_end < lineCount; block_end++) {\n\t\t\t\tline = cm.getLineHandle(block_end);\n\t\t\t\tif(line.text.match(/^\\s*$/)) {\n\t\t\t\t\t// empty or all whitespace - keep going\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tif(code_type(cm, block_end, line) !== \"indented\") {\n\t\t\t\t\t\tblock_end -= 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// if we are going to un-indent based on a selected set of lines, and the next line is indented too, we need to\n\t\t// insert a blank line so that the next line(s) continue to be indented code\n\t\tvar next_line = cm.getLineHandle(block_end + 1),\n\t\t\tnext_line_last_tok = next_line && cm.getTokenAt({\n\t\t\t\tline: block_end + 1,\n\t\t\t\tch: next_line.text.length - 1\n\t\t\t}),\n\t\t\tnext_line_indented = next_line_last_tok && token_state(next_line_last_tok).indentedCode;\n\t\tif(next_line_indented) {\n\t\t\tcm.replaceRange(\"\\n\", {\n\t\t\t\tline: block_end + 1,\n\t\t\t\tch: 0\n\t\t\t});\n\t\t}\n\n\t\tfor(var i = block_start; i <= block_end; i++) {\n\t\t\tcm.indentLine(i, \"subtract\"); // TODO: this doesn't get tracked in the history, so can't be undone :(\n\t\t}\n\t\tcm.focus();\n\t} else {\n\t\t// insert code formatting\n\t\tvar no_sel_and_starting_of_line = (cur_start.line === cur_end.line && cur_start.ch === cur_end.ch && cur_start.ch === 0);\n\t\tvar sel_multi = cur_start.line !== cur_end.line;\n\t\tif(no_sel_and_starting_of_line || sel_multi) {\n\t\t\tinsertFencingAtSelection(cm, cur_start, cur_end, fenceCharsToInsert);\n\t\t} else {\n\t\t\t_replaceSelection(cm, false, [\"`\", \"`\"]);\n\t\t}\n\t}\n}\n\n/**\n * Action for toggling blockquote.\n */\nfunction toggleBlockquote(editor) {\n\tvar cm = editor.codemirror;\n\t_toggleLine(cm, \"quote\");\n}\n\n/**\n * Action for toggling heading size: normal -> h1 -> h2 -> h3 -> h4 -> h5 -> h6 -> normal\n */\nfunction toggleHeadingSmaller(editor) {\n\tvar cm = editor.codemirror;\n\t_toggleHeading(cm, \"smaller\");\n}\n\n/**\n * Action for toggling heading size: normal -> h6 -> h5 -> h4 -> h3 -> h2 -> h1 -> normal\n */\nfunction toggleHeadingBigger(editor) {\n\tvar cm = editor.codemirror;\n\t_toggleHeading(cm, \"bigger\");\n}\n\n/**\n * Action for toggling heading size 1\n */\nfunction toggleHeading1(editor) {\n\tvar cm = editor.codemirror;\n\t_toggleHeading(cm, undefined, 1);\n}\n\n/**\n * Action for toggling heading size 2\n */\nfunction toggleHeading2(editor) {\n\tvar cm = editor.codemirror;\n\t_toggleHeading(cm, undefined, 2);\n}\n\n/**\n * Action for toggling heading size 3\n */\nfunction toggleHeading3(editor) {\n\tvar cm = editor.codemirror;\n\t_toggleHeading(cm, undefined, 3);\n}\n\n\n/**\n * Action for toggling ul.\n */\nfunction toggleUnorderedList(editor) {\n\tvar cm = editor.codemirror;\n\t_toggleLine(cm, \"unordered-list\");\n}\n\n\n/**\n * Action for toggling ol.\n */\nfunction toggleOrderedList(editor) {\n\tvar cm = editor.codemirror;\n\t_toggleLine(cm, \"ordered-list\");\n}\n\n/**\n * Action for clean block (remove headline, list, blockquote code, markers)\n */\nfunction cleanBlock(editor) {\n\tvar cm = editor.codemirror;\n\t_cleanBlock(cm);\n}\n\n/**\n * Action for drawing a link.\n */\nfunction drawLink(editor) {\n\tvar cm = editor.codemirror;\n\tvar stat = getState(cm);\n\tvar options = editor.options;\n\tvar url = \"http://\";\n\tif(options.promptURLs) {\n\t\turl = prompt(options.promptTexts.link);\n\t\tif(!url) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t_replaceSelection(cm, stat.link, options.insertTexts.link, url);\n}\n\n/**\n * Action for drawing an img.\n */\nfunction drawImage(editor) {\n\tvar cm = editor.codemirror;\n\tvar stat = getState(cm);\n\tvar options = editor.options;\n\tvar url = \"http://\";\n\tif(options.promptURLs) {\n\t\turl = prompt(options.promptTexts.image);\n\t\tif(!url) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t_replaceSelection(cm, stat.image, options.insertTexts.image, url);\n}\n\n/**\n * Action for drawing a table.\n */\nfunction drawTable(editor) {\n\tvar cm = editor.codemirror;\n\tvar stat = getState(cm);\n\tvar options = editor.options;\n\t_replaceSelection(cm, stat.table, options.insertTexts.table);\n}\n\n/**\n * Action for drawing a horizontal rule.\n */\nfunction drawHorizontalRule(editor) {\n\tvar cm = editor.codemirror;\n\tvar stat = getState(cm);\n\tvar options = editor.options;\n\t_replaceSelection(cm, stat.image, options.insertTexts.horizontalRule);\n}\n\n\n/**\n * Undo action.\n */\nfunction undo(editor) {\n\tvar cm = editor.codemirror;\n\tcm.undo();\n\tcm.focus();\n}\n\n\n/**\n * Redo action.\n */\nfunction redo(editor) {\n\tvar cm = editor.codemirror;\n\tcm.redo();\n\tcm.focus();\n}\n\n\n/**\n * Toggle side by side preview\n */\nfunction toggleSideBySide(editor) {\n\tvar cm = editor.codemirror;\n\tvar wrapper = cm.getWrapperElement();\n\tvar preview = wrapper.nextSibling;\n\tvar toolbarButton = editor.toolbarElements[\"side-by-side\"];\n\tvar useSideBySideListener = false;\n\tif(/editor-preview-active-side/.test(preview.className)) {\n\t\tpreview.className = preview.className.replace(\n\t\t\t/\\s*editor-preview-active-side\\s*/g, \"\"\n\t\t);\n\t\ttoolbarButton.className = toolbarButton.className.replace(/\\s*active\\s*/g, \"\");\n\t\twrapper.className = wrapper.className.replace(/\\s*CodeMirror-sided\\s*/g, \" \");\n\t} else {\n\t\t// When the preview button is clicked for the first time,\n\t\t// give some time for the transition from editor.css to fire and the view to slide from right to left,\n\t\t// instead of just appearing.\n\t\tsetTimeout(function() {\n\t\t\tif(!cm.getOption(\"fullScreen\"))\n\t\t\t\ttoggleFullScreen(editor);\n\t\t\tpreview.className += \" editor-preview-active-side\";\n\t\t}, 1);\n\t\ttoolbarButton.className += \" active\";\n\t\twrapper.className += \" CodeMirror-sided\";\n\t\tuseSideBySideListener = true;\n\t}\n\n\t// Hide normal preview if active\n\tvar previewNormal = wrapper.lastChild;\n\tif(/editor-preview-active/.test(previewNormal.className)) {\n\t\tpreviewNormal.className = previewNormal.className.replace(\n\t\t\t/\\s*editor-preview-active\\s*/g, \"\"\n\t\t);\n\t\tvar toolbar = editor.toolbarElements.preview;\n\t\tvar toolbar_div = wrapper.previousSibling;\n\t\ttoolbar.className = toolbar.className.replace(/\\s*active\\s*/g, \"\");\n\t\ttoolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, \"\");\n\t}\n\n\tvar sideBySideRenderingFunction = function() {\n\t\tpreview.innerHTML = editor.options.previewRender(editor.value(), preview);\n\t};\n\n\tif(!cm.sideBySideRenderingFunction) {\n\t\tcm.sideBySideRenderingFunction = sideBySideRenderingFunction;\n\t}\n\n\tif(useSideBySideListener) {\n\t\tpreview.innerHTML = editor.options.previewRender(editor.value(), preview);\n\t\tcm.on(\"update\", cm.sideBySideRenderingFunction);\n\t} else {\n\t\tcm.off(\"update\", cm.sideBySideRenderingFunction);\n\t}\n\n\t// Refresh to fix selection being off (#309)\n\tcm.refresh();\n}\n\n\n/**\n * Preview action.\n */\nfunction togglePreview(editor) {\n\tvar cm = editor.codemirror;\n\tvar wrapper = cm.getWrapperElement();\n\tvar toolbar_div = wrapper.previousSibling;\n\tvar toolbar = editor.options.toolbar ? editor.toolbarElements.preview : false;\n\tvar preview = wrapper.lastChild;\n\tif(!preview || !/editor-preview/.test(preview.className)) {\n\t\tpreview = document.createElement(\"div\");\n\t\tpreview.className = \"editor-preview\";\n\t\twrapper.appendChild(preview);\n\t}\n\tif(/editor-preview-active/.test(preview.className)) {\n\t\tpreview.className = preview.className.replace(\n\t\t\t/\\s*editor-preview-active\\s*/g, \"\"\n\t\t);\n\t\tif(toolbar) {\n\t\t\ttoolbar.className = toolbar.className.replace(/\\s*active\\s*/g, \"\");\n\t\t\ttoolbar_div.className = toolbar_div.className.replace(/\\s*disabled-for-preview*/g, \"\");\n\t\t}\n\t} else {\n\t\t// When the preview button is clicked for the first time,\n\t\t// give some time for the transition from editor.css to fire and the view to slide from right to left,\n\t\t// instead of just appearing.\n\t\tsetTimeout(function() {\n\t\t\tpreview.className += \" editor-preview-active\";\n\t\t}, 1);\n\t\tif(toolbar) {\n\t\t\ttoolbar.className += \" active\";\n\t\t\ttoolbar_div.className += \" disabled-for-preview\";\n\t\t}\n\t}\n\tpreview.innerHTML = editor.options.previewRender(editor.value(), preview);\n\n\t// Turn off side by side if needed\n\tvar sidebyside = cm.getWrapperElement().nextSibling;\n\tif(/editor-preview-active-side/.test(sidebyside.className))\n\t\ttoggleSideBySide(editor);\n}\n\nfunction _replaceSelection(cm, active, startEnd, url) {\n\tif(/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n\t\treturn;\n\n\tvar text;\n\tvar start = startEnd[0];\n\tvar end = startEnd[1];\n\tvar startPoint = cm.getCursor(\"start\");\n\tvar endPoint = cm.getCursor(\"end\");\n\tif(url) {\n\t\tend = end.replace(\"#url#\", url);\n\t}\n\tif(active) {\n\t\ttext = cm.getLine(startPoint.line);\n\t\tstart = text.slice(0, startPoint.ch);\n\t\tend = text.slice(startPoint.ch);\n\t\tcm.replaceRange(start + end, {\n\t\t\tline: startPoint.line,\n\t\t\tch: 0\n\t\t});\n\t} else {\n\t\ttext = cm.getSelection();\n\t\tcm.replaceSelection(start + text + end);\n\n\t\tstartPoint.ch += start.length;\n\t\tif(startPoint !== endPoint) {\n\t\t\tendPoint.ch += start.length;\n\t\t}\n\t}\n\tcm.setSelection(startPoint, endPoint);\n\tcm.focus();\n}\n\n\nfunction _toggleHeading(cm, direction, size) {\n\tif(/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n\t\treturn;\n\n\tvar startPoint = cm.getCursor(\"start\");\n\tvar endPoint = cm.getCursor(\"end\");\n\tfor(var i = startPoint.line; i <= endPoint.line; i++) {\n\t\t(function(i) {\n\t\t\tvar text = cm.getLine(i);\n\t\t\tvar currHeadingLevel = text.search(/[^#]/);\n\n\t\t\tif(direction !== undefined) {\n\t\t\t\tif(currHeadingLevel <= 0) {\n\t\t\t\t\tif(direction == \"bigger\") {\n\t\t\t\t\t\ttext = \"###### \" + text;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttext = \"# \" + text;\n\t\t\t\t\t}\n\t\t\t\t} else if(currHeadingLevel == 6 && direction == \"smaller\") {\n\t\t\t\t\ttext = text.substr(7);\n\t\t\t\t} else if(currHeadingLevel == 1 && direction == \"bigger\") {\n\t\t\t\t\ttext = text.substr(2);\n\t\t\t\t} else {\n\t\t\t\t\tif(direction == \"bigger\") {\n\t\t\t\t\t\ttext = text.substr(1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttext = \"#\" + text;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(size == 1) {\n\t\t\t\t\tif(currHeadingLevel <= 0) {\n\t\t\t\t\t\ttext = \"# \" + text;\n\t\t\t\t\t} else if(currHeadingLevel == size) {\n\t\t\t\t\t\ttext = text.substr(currHeadingLevel + 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttext = \"# \" + text.substr(currHeadingLevel + 1);\n\t\t\t\t\t}\n\t\t\t\t} else if(size == 2) {\n\t\t\t\t\tif(currHeadingLevel <= 0) {\n\t\t\t\t\t\ttext = \"## \" + text;\n\t\t\t\t\t} else if(currHeadingLevel == size) {\n\t\t\t\t\t\ttext = text.substr(currHeadingLevel + 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttext = \"## \" + text.substr(currHeadingLevel + 1);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(currHeadingLevel <= 0) {\n\t\t\t\t\t\ttext = \"### \" + text;\n\t\t\t\t\t} else if(currHeadingLevel == size) {\n\t\t\t\t\t\ttext = text.substr(currHeadingLevel + 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttext = \"### \" + text.substr(currHeadingLevel + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcm.replaceRange(text, {\n\t\t\t\tline: i,\n\t\t\t\tch: 0\n\t\t\t}, {\n\t\t\t\tline: i,\n\t\t\t\tch: 99999999999999\n\t\t\t});\n\t\t})(i);\n\t}\n\tcm.focus();\n}\n\n\nfunction _toggleLine(cm, name) {\n\tif(/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n\t\treturn;\n\n\tvar stat = getState(cm);\n\tvar startPoint = cm.getCursor(\"start\");\n\tvar endPoint = cm.getCursor(\"end\");\n\tvar repl = {\n\t\t\"quote\": /^(\\s*)\\>\\s+/,\n\t\t\"unordered-list\": /^(\\s*)(\\*|\\-|\\+)\\s+/,\n\t\t\"ordered-list\": /^(\\s*)\\d+\\.\\s+/\n\t};\n\tvar map = {\n\t\t\"quote\": \"> \",\n\t\t\"unordered-list\": \"* \",\n\t\t\"ordered-list\": \"1. \"\n\t};\n\tfor(var i = startPoint.line; i <= endPoint.line; i++) {\n\t\t(function(i) {\n\t\t\tvar text = cm.getLine(i);\n\t\t\tif(stat[name]) {\n\t\t\t\ttext = text.replace(repl[name], \"$1\");\n\t\t\t} else {\n\t\t\t\ttext = map[name] + text;\n\t\t\t}\n\t\t\tcm.replaceRange(text, {\n\t\t\t\tline: i,\n\t\t\t\tch: 0\n\t\t\t}, {\n\t\t\t\tline: i,\n\t\t\t\tch: 99999999999999\n\t\t\t});\n\t\t})(i);\n\t}\n\tcm.focus();\n}\n\nfunction _toggleBlock(editor, type, start_chars, end_chars) {\n\tif(/editor-preview-active/.test(editor.codemirror.getWrapperElement().lastChild.className))\n\t\treturn;\n\n\tend_chars = (typeof end_chars === \"undefined\") ? start_chars : end_chars;\n\tvar cm = editor.codemirror;\n\tvar stat = getState(cm);\n\n\tvar text;\n\tvar start = start_chars;\n\tvar end = end_chars;\n\n\tvar startPoint = cm.getCursor(\"start\");\n\tvar endPoint = cm.getCursor(\"end\");\n\n\tif(stat[type]) {\n\t\ttext = cm.getLine(startPoint.line);\n\t\tstart = text.slice(0, startPoint.ch);\n\t\tend = text.slice(startPoint.ch);\n\t\tif(type == \"bold\") {\n\t\t\tstart = start.replace(/(\\*\\*|__)(?![\\s\\S]*(\\*\\*|__))/, \"\");\n\t\t\tend = end.replace(/(\\*\\*|__)/, \"\");\n\t\t} else if(type == \"italic\") {\n\t\t\tstart = start.replace(/(\\*|_)(?![\\s\\S]*(\\*|_))/, \"\");\n\t\t\tend = end.replace(/(\\*|_)/, \"\");\n\t\t} else if(type == \"strikethrough\") {\n\t\t\tstart = start.replace(/(\\*\\*|~~)(?![\\s\\S]*(\\*\\*|~~))/, \"\");\n\t\t\tend = end.replace(/(\\*\\*|~~)/, \"\");\n\t\t}\n\t\tcm.replaceRange(start + end, {\n\t\t\tline: startPoint.line,\n\t\t\tch: 0\n\t\t}, {\n\t\t\tline: startPoint.line,\n\t\t\tch: 99999999999999\n\t\t});\n\n\t\tif(type == \"bold\" || type == \"strikethrough\") {\n\t\t\tstartPoint.ch -= 2;\n\t\t\tif(startPoint !== endPoint) {\n\t\t\t\tendPoint.ch -= 2;\n\t\t\t}\n\t\t} else if(type == \"italic\") {\n\t\t\tstartPoint.ch -= 1;\n\t\t\tif(startPoint !== endPoint) {\n\t\t\t\tendPoint.ch -= 1;\n\t\t\t}\n\t\t}\n\t} else {\n\t\ttext = cm.getSelection();\n\t\tif(type == \"bold\") {\n\t\t\ttext = text.split(\"**\").join(\"\");\n\t\t\ttext = text.split(\"__\").join(\"\");\n\t\t} else if(type == \"italic\") {\n\t\t\ttext = text.split(\"*\").join(\"\");\n\t\t\ttext = text.split(\"_\").join(\"\");\n\t\t} else if(type == \"strikethrough\") {\n\t\t\ttext = text.split(\"~~\").join(\"\");\n\t\t}\n\t\tcm.replaceSelection(start + text + end);\n\n\t\tstartPoint.ch += start_chars.length;\n\t\tendPoint.ch = startPoint.ch + text.length;\n\t}\n\n\tcm.setSelection(startPoint, endPoint);\n\tcm.focus();\n}\n\nfunction _cleanBlock(cm) {\n\tif(/editor-preview-active/.test(cm.getWrapperElement().lastChild.className))\n\t\treturn;\n\n\tvar startPoint = cm.getCursor(\"start\");\n\tvar endPoint = cm.getCursor(\"end\");\n\tvar text;\n\n\tfor(var line = startPoint.line; line <= endPoint.line; line++) {\n\t\ttext = cm.getLine(line);\n\t\ttext = text.replace(/^[ ]*([# ]+|\\*|\\-|[> ]+|[0-9]+(.|\\)))[ ]*/, \"\");\n\n\t\tcm.replaceRange(text, {\n\t\t\tline: line,\n\t\t\tch: 0\n\t\t}, {\n\t\t\tline: line,\n\t\t\tch: 99999999999999\n\t\t});\n\t}\n}\n\n// Merge the properties of one object into another.\nfunction _mergeProperties(target, source) {\n\tfor(var property in source) {\n\t\tif(source.hasOwnProperty(property)) {\n\t\t\tif(source[property] instanceof Array) {\n\t\t\t\ttarget[property] = source[property].concat(target[property] instanceof Array ? target[property] : []);\n\t\t\t} else if(\n\t\t\t\tsource[property] !== null &&\n\t\t\t\ttypeof source[property] === \"object\" &&\n\t\t\t\tsource[property].constructor === Object\n\t\t\t) {\n\t\t\t\ttarget[property] = _mergeProperties(target[property] || {}, source[property]);\n\t\t\t} else {\n\t\t\t\ttarget[property] = source[property];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn target;\n}\n\n// Merge an arbitrary number of objects into one.\nfunction extend(target) {\n\tfor(var i = 1; i < arguments.length; i++) {\n\t\ttarget = _mergeProperties(target, arguments[i]);\n\t}\n\n\treturn target;\n}\n\n/* The right word count in respect for CJK. */\nfunction wordCount(data) {\n\tvar pattern = /[a-zA-Z0-9_\\u0392-\\u03c9\\u0410-\\u04F9]+|[\\u4E00-\\u9FFF\\u3400-\\u4dbf\\uf900-\\ufaff\\u3040-\\u309f\\uac00-\\ud7af]+/g;\n\tvar m = data.match(pattern);\n\tvar count = 0;\n\tif(m === null) return count;\n\tfor(var i = 0; i < m.length; i++) {\n\t\tif(m[i].charCodeAt(0) >= 0x4E00) {\n\t\t\tcount += m[i].length;\n\t\t} else {\n\t\t\tcount += 1;\n\t\t}\n\t}\n\treturn count;\n}\n\nvar toolbarBuiltInButtons = {\n\t\"bold\": {\n\t\tname: \"bold\",\n\t\taction: toggleBold,\n\t\tclassName: \"fa fa-bold\",\n\t\ttitle: \"Bold\",\n\t\tdefault: true\n\t},\n\t\"italic\": {\n\t\tname: \"italic\",\n\t\taction: toggleItalic,\n\t\tclassName: \"fa fa-italic\",\n\t\ttitle: \"Italic\",\n\t\tdefault: true\n\t},\n\t\"strikethrough\": {\n\t\tname: \"strikethrough\",\n\t\taction: toggleStrikethrough,\n\t\tclassName: \"fa fa-strikethrough\",\n\t\ttitle: \"Strikethrough\"\n\t},\n\t\"heading\": {\n\t\tname: \"heading\",\n\t\taction: toggleHeadingSmaller,\n\t\tclassName: \"fa fa-header\",\n\t\ttitle: \"Heading\",\n\t\tdefault: true\n\t},\n\t\"heading-smaller\": {\n\t\tname: \"heading-smaller\",\n\t\taction: toggleHeadingSmaller,\n\t\tclassName: \"fa fa-header fa-header-x fa-header-smaller\",\n\t\ttitle: \"Smaller Heading\"\n\t},\n\t\"heading-bigger\": {\n\t\tname: \"heading-bigger\",\n\t\taction: toggleHeadingBigger,\n\t\tclassName: \"fa fa-header fa-header-x fa-header-bigger\",\n\t\ttitle: \"Bigger Heading\"\n\t},\n\t\"heading-1\": {\n\t\tname: \"heading-1\",\n\t\taction: toggleHeading1,\n\t\tclassName: \"fa fa-header fa-header-x fa-header-1\",\n\t\ttitle: \"Big Heading\"\n\t},\n\t\"heading-2\": {\n\t\tname: \"heading-2\",\n\t\taction: toggleHeading2,\n\t\tclassName: \"fa fa-header fa-header-x fa-header-2\",\n\t\ttitle: \"Medium Heading\"\n\t},\n\t\"heading-3\": {\n\t\tname: \"heading-3\",\n\t\taction: toggleHeading3,\n\t\tclassName: \"fa fa-header fa-header-x fa-header-3\",\n\t\ttitle: \"Small Heading\"\n\t},\n\t\"separator-1\": {\n\t\tname: \"separator-1\"\n\t},\n\t\"code\": {\n\t\tname: \"code\",\n\t\taction: toggleCodeBlock,\n\t\tclassName: \"fa fa-code\",\n\t\ttitle: \"Code\"\n\t},\n\t\"quote\": {\n\t\tname: \"quote\",\n\t\taction: toggleBlockquote,\n\t\tclassName: \"fa fa-quote-left\",\n\t\ttitle: \"Quote\",\n\t\tdefault: true\n\t},\n\t\"unordered-list\": {\n\t\tname: \"unordered-list\",\n\t\taction: toggleUnorderedList,\n\t\tclassName: \"fa fa-list-ul\",\n\t\ttitle: \"Generic List\",\n\t\tdefault: true\n\t},\n\t\"ordered-list\": {\n\t\tname: \"ordered-list\",\n\t\taction: toggleOrderedList,\n\t\tclassName: \"fa fa-list-ol\",\n\t\ttitle: \"Numbered List\",\n\t\tdefault: true\n\t},\n\t\"clean-block\": {\n\t\tname: \"clean-block\",\n\t\taction: cleanBlock,\n\t\tclassName: \"fa fa-eraser fa-clean-block\",\n\t\ttitle: \"Clean block\"\n\t},\n\t\"separator-2\": {\n\t\tname: \"separator-2\"\n\t},\n\t\"link\": {\n\t\tname: \"link\",\n\t\taction: drawLink,\n\t\tclassName: \"fa fa-link\",\n\t\ttitle: \"Create Link\",\n\t\tdefault: true\n\t},\n\t\"image\": {\n\t\tname: \"image\",\n\t\taction: drawImage,\n\t\tclassName: \"fa fa-picture-o\",\n\t\ttitle: \"Insert Image\",\n\t\tdefault: true\n\t},\n\t\"table\": {\n\t\tname: \"table\",\n\t\taction: drawTable,\n\t\tclassName: \"fa fa-table\",\n\t\ttitle: \"Insert Table\"\n\t},\n\t\"horizontal-rule\": {\n\t\tname: \"horizontal-rule\",\n\t\taction: drawHorizontalRule,\n\t\tclassName: \"fa fa-minus\",\n\t\ttitle: \"Insert Horizontal Line\"\n\t},\n\t\"separator-3\": {\n\t\tname: \"separator-3\"\n\t},\n\t\"preview\": {\n\t\tname: \"preview\",\n\t\taction: togglePreview,\n\t\tclassName: \"fa fa-eye no-disable\",\n\t\ttitle: \"Toggle Preview\",\n\t\tdefault: true\n\t},\n\t\"side-by-side\": {\n\t\tname: \"side-by-side\",\n\t\taction: toggleSideBySide,\n\t\tclassName: \"fa fa-columns no-disable no-mobile\",\n\t\ttitle: \"Toggle Side by Side\",\n\t\tdefault: true\n\t},\n\t\"fullscreen\": {\n\t\tname: \"fullscreen\",\n\t\taction: toggleFullScreen,\n\t\tclassName: \"fa fa-arrows-alt no-disable no-mobile\",\n\t\ttitle: \"Toggle Fullscreen\",\n\t\tdefault: true\n\t},\n\t\"separator-4\": {\n\t\tname: \"separator-4\"\n\t},\n\t\"guide\": {\n\t\tname: \"guide\",\n\t\taction: \"https://simplemde.com/markdown-guide\",\n\t\tclassName: \"fa fa-question-circle\",\n\t\ttitle: \"Markdown Guide\",\n\t\tdefault: true\n\t},\n\t\"separator-5\": {\n\t\tname: \"separator-5\"\n\t},\n\t\"undo\": {\n\t\tname: \"undo\",\n\t\taction: undo,\n\t\tclassName: \"fa fa-undo no-disable\",\n\t\ttitle: \"Undo\"\n\t},\n\t\"redo\": {\n\t\tname: \"redo\",\n\t\taction: redo,\n\t\tclassName: \"fa fa-repeat no-disable\",\n\t\ttitle: \"Redo\"\n\t}\n};\n\nvar insertTexts = {\n\tlink: [\"[\", \"](#url#)\"],\n\timage: [\"![](\", \"#url#)\"],\n\ttable: [\"\", \"\\n\\n| Column 1 | Column 2 | Column 3 |\\n| -------- | -------- | -------- |\\n| Text     | Text     | Text     |\\n\\n\"],\n\thorizontalRule: [\"\", \"\\n\\n-----\\n\\n\"]\n};\n\nvar promptTexts = {\n\tlink: \"URL for the link:\",\n\timage: \"URL of the image:\"\n};\n\nvar blockStyles = {\n\t\"bold\": \"**\",\n\t\"code\": \"```\",\n\t\"italic\": \"*\"\n};\n\n/**\n * Interface of SimpleMDE.\n */\nfunction SimpleMDE(options) {\n\t// Handle options parameter\n\toptions = options || {};\n\n\n\t// Used later to refer to it\"s parent\n\toptions.parent = this;\n\n\n\t// Check if Font Awesome needs to be auto downloaded\n\tvar autoDownloadFA = true;\n\n\tif(options.autoDownloadFontAwesome === false) {\n\t\tautoDownloadFA = false;\n\t}\n\n\tif(options.autoDownloadFontAwesome !== true) {\n\t\tvar styleSheets = document.styleSheets;\n\t\tfor(var i = 0; i < styleSheets.length; i++) {\n\t\t\tif(!styleSheets[i].href)\n\t\t\t\tcontinue;\n\n\t\t\tif(styleSheets[i].href.indexOf(\"//maxcdn.bootstrapcdn.com/font-awesome/\") > -1) {\n\t\t\t\tautoDownloadFA = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tif(autoDownloadFA) {\n\t\tvar link = document.createElement(\"link\");\n\t\tlink.rel = \"stylesheet\";\n\t\tlink.href = \"https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css\";\n\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link);\n\t}\n\n\n\t// Find the textarea to use\n\tif(options.element) {\n\t\tthis.element = options.element;\n\t} else if(options.element === null) {\n\t\t// This means that the element option was specified, but no element was found\n\t\tconsole.log(\"SimpleMDE: Error. No element was found.\");\n\t\treturn;\n\t}\n\n\n\t// Handle toolbar\n\tif(options.toolbar === undefined) {\n\t\t// Initialize\n\t\toptions.toolbar = [];\n\n\n\t\t// Loop over the built in buttons, to get the preferred order\n\t\tfor(var key in toolbarBuiltInButtons) {\n\t\t\tif(toolbarBuiltInButtons.hasOwnProperty(key)) {\n\t\t\t\tif(key.indexOf(\"separator-\") != -1) {\n\t\t\t\t\toptions.toolbar.push(\"|\");\n\t\t\t\t}\n\n\t\t\t\tif(toolbarBuiltInButtons[key].default === true || (options.showIcons && options.showIcons.constructor === Array && options.showIcons.indexOf(key) != -1)) {\n\t\t\t\t\toptions.toolbar.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\t// Handle status bar\n\tif(!options.hasOwnProperty(\"status\")) {\n\t\toptions.status = [\"autosave\", \"lines\", \"words\", \"cursor\"];\n\t}\n\n\n\t// Add default preview rendering function\n\tif(!options.previewRender) {\n\t\toptions.previewRender = function(plainText) {\n\t\t\t// Note: \"this\" refers to the options object\n\t\t\treturn this.parent.markdown(plainText);\n\t\t};\n\t}\n\n\n\t// Set default options for parsing config\n\toptions.parsingConfig = extend({\n\t\thighlightFormatting: true // needed for toggleCodeBlock to detect types of code\n\t}, options.parsingConfig || {});\n\n\n\t// Merging the insertTexts, with the given options\n\toptions.insertTexts = extend({}, insertTexts, options.insertTexts || {});\n\n\n\t// Merging the promptTexts, with the given options\n\toptions.promptTexts = promptTexts;\n\n\n\t// Merging the blockStyles, with the given options\n\toptions.blockStyles = extend({}, blockStyles, options.blockStyles || {});\n\n\n\t// Merging the shortcuts, with the given options\n\toptions.shortcuts = extend({}, shortcuts, options.shortcuts || {});\n\n\n\t// Change unique_id to uniqueId for backwards compatibility\n\tif(options.autosave != undefined && options.autosave.unique_id != undefined && options.autosave.unique_id != \"\")\n\t\toptions.autosave.uniqueId = options.autosave.unique_id;\n\n\n\t// Update this options\n\tthis.options = options;\n\n\n\t// Auto render\n\tthis.render();\n\n\n\t// The codemirror component is only available after rendering\n\t// so, the setter for the initialValue can only run after\n\t// the element has been rendered\n\tif(options.initialValue && (!this.options.autosave || this.options.autosave.foundSavedValue !== true)) {\n\t\tthis.value(options.initialValue);\n\t}\n}\n\n/**\n * Default markdown render.\n */\nSimpleMDE.prototype.markdown = function(text) {\n\tif(marked) {\n\t\t// Initialize\n\t\tvar markedOptions = {};\n\n\n\t\t// Update options\n\t\tif(this.options && this.options.renderingConfig && this.options.renderingConfig.singleLineBreaks === false) {\n\t\t\tmarkedOptions.breaks = false;\n\t\t} else {\n\t\t\tmarkedOptions.breaks = true;\n\t\t}\n\n\t\tif(this.options && this.options.renderingConfig && this.options.renderingConfig.codeSyntaxHighlighting === true && window.hljs) {\n\t\t\tmarkedOptions.highlight = function(code) {\n\t\t\t\treturn window.hljs.highlightAuto(code).value;\n\t\t\t};\n\t\t}\n\n\n\t\t// Set options\n\t\tmarked.setOptions(markedOptions);\n\n\n\t\t// Return\n\t\treturn marked(text);\n\t}\n};\n\n/**\n * Render editor to the given element.\n */\nSimpleMDE.prototype.render = function(el) {\n\tif(!el) {\n\t\tel = this.element || document.getElementsByTagName(\"textarea\")[0];\n\t}\n\n\tif(this._rendered && this._rendered === el) {\n\t\t// Already rendered.\n\t\treturn;\n\t}\n\n\tthis.element = el;\n\tvar options = this.options;\n\n\tvar self = this;\n\tvar keyMaps = {};\n\n\tfor(var key in options.shortcuts) {\n\t\t// null stands for \"do not bind this command\"\n\t\tif(options.shortcuts[key] !== null && bindings[key] !== null) {\n\t\t\t(function(key) {\n\t\t\t\tkeyMaps[fixShortcut(options.shortcuts[key])] = function() {\n\t\t\t\t\tbindings[key](self);\n\t\t\t\t};\n\t\t\t})(key);\n\t\t}\n\t}\n\n\tkeyMaps[\"Enter\"] = \"newlineAndIndentContinueMarkdownList\";\n\tkeyMaps[\"Tab\"] = \"tabAndIndentMarkdownList\";\n\tkeyMaps[\"Shift-Tab\"] = \"shiftTabAndUnindentMarkdownList\";\n\tkeyMaps[\"Esc\"] = function(cm) {\n\t\tif(cm.getOption(\"fullScreen\")) toggleFullScreen(self);\n\t};\n\n\tdocument.addEventListener(\"keydown\", function(e) {\n\t\te = e || window.event;\n\n\t\tif(e.keyCode == 27) {\n\t\t\tif(self.codemirror.getOption(\"fullScreen\")) toggleFullScreen(self);\n\t\t}\n\t}, false);\n\n\tvar mode, backdrop;\n\tif(options.spellChecker !== false) {\n\t\tmode = \"spell-checker\";\n\t\tbackdrop = options.parsingConfig;\n\t\tbackdrop.name = \"gfm\";\n\t\tbackdrop.gitHubSpice = false;\n\n\t\tCodeMirrorSpellChecker({\n\t\t\tcodeMirrorInstance: CodeMirror\n\t\t});\n\t} else {\n\t\tmode = options.parsingConfig;\n\t\tmode.name = \"gfm\";\n\t\tmode.gitHubSpice = false;\n\t}\n\n\tthis.codemirror = CodeMirror.fromTextArea(el, {\n\t\tmode: mode,\n\t\tbackdrop: backdrop,\n\t\ttheme: \"paper\",\n\t\ttabSize: (options.tabSize != undefined) ? options.tabSize : 2,\n\t\tindentUnit: (options.tabSize != undefined) ? options.tabSize : 2,\n\t\tindentWithTabs: (options.indentWithTabs === false) ? false : true,\n\t\tlineNumbers: false,\n\t\tautofocus: (options.autofocus === true) ? true : false,\n\t\textraKeys: keyMaps,\n\t\tlineWrapping: (options.lineWrapping === false) ? false : true,\n\t\tallowDropFileTypes: [\"text/plain\"],\n\t\tplaceholder: options.placeholder || el.getAttribute(\"placeholder\") || \"\",\n\t\tstyleSelectedText: (options.styleSelectedText != undefined) ? options.styleSelectedText : true\n\t});\n\n\tif(options.forceSync === true) {\n\t\tvar cm = this.codemirror;\n\t\tcm.on(\"change\", function() {\n\t\t\tcm.save();\n\t\t});\n\t}\n\n\tthis.gui = {};\n\n\tif(options.toolbar !== false) {\n\t\tthis.gui.toolbar = this.createToolbar();\n\t}\n\tif(options.status !== false) {\n\t\tthis.gui.statusbar = this.createStatusbar();\n\t}\n\tif(options.autosave != undefined && options.autosave.enabled === true) {\n\t\tthis.autosave();\n\t}\n\n\tthis.gui.sideBySide = this.createSideBySide();\n\n\tthis._rendered = this.element;\n\n\n\t// Fixes CodeMirror bug (#344)\n\tvar temp_cm = this.codemirror;\n\tsetTimeout(function() {\n\t\ttemp_cm.refresh();\n\t}.bind(temp_cm), 0);\n};\n\n// Safari, in Private Browsing Mode, looks like it supports localStorage but all calls to setItem throw QuotaExceededError. We're going to detect this and set a variable accordingly.\nfunction isLocalStorageAvailable() {\n\tif(typeof localStorage === \"object\") {\n\t\ttry {\n\t\t\tlocalStorage.setItem(\"smde_localStorage\", 1);\n\t\t\tlocalStorage.removeItem(\"smde_localStorage\");\n\t\t} catch(e) {\n\t\t\treturn false;\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nSimpleMDE.prototype.autosave = function() {\n\tif(isLocalStorageAvailable()) {\n\t\tvar simplemde = this;\n\n\t\tif(this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == \"\") {\n\t\t\tconsole.log(\"SimpleMDE: You must set a uniqueId to use the autosave feature\");\n\t\t\treturn;\n\t\t}\n\n\t\tif(simplemde.element.form != null && simplemde.element.form != undefined) {\n\t\t\tsimplemde.element.form.addEventListener(\"submit\", function() {\n\t\t\t\tlocalStorage.removeItem(\"smde_\" + simplemde.options.autosave.uniqueId);\n\t\t\t});\n\t\t}\n\n\t\tif(this.options.autosave.loaded !== true) {\n\t\t\tif(typeof localStorage.getItem(\"smde_\" + this.options.autosave.uniqueId) == \"string\" && localStorage.getItem(\"smde_\" + this.options.autosave.uniqueId) != \"\") {\n\t\t\t\tthis.codemirror.setValue(localStorage.getItem(\"smde_\" + this.options.autosave.uniqueId));\n\t\t\t\tthis.options.autosave.foundSavedValue = true;\n\t\t\t}\n\n\t\t\tthis.options.autosave.loaded = true;\n\t\t}\n\n\t\tlocalStorage.setItem(\"smde_\" + this.options.autosave.uniqueId, simplemde.value());\n\n\t\tvar el = document.getElementById(\"autosaved\");\n\t\tif(el != null && el != undefined && el != \"\") {\n\t\t\tvar d = new Date();\n\t\t\tvar hh = d.getHours();\n\t\t\tvar m = d.getMinutes();\n\t\t\tvar dd = \"am\";\n\t\t\tvar h = hh;\n\t\t\tif(h >= 12) {\n\t\t\t\th = hh - 12;\n\t\t\t\tdd = \"pm\";\n\t\t\t}\n\t\t\tif(h == 0) {\n\t\t\t\th = 12;\n\t\t\t}\n\t\t\tm = m < 10 ? \"0\" + m : m;\n\n\t\t\tel.innerHTML = \"Autosaved: \" + h + \":\" + m + \" \" + dd;\n\t\t}\n\n\t\tthis.autosaveTimeoutId = setTimeout(function() {\n\t\t\tsimplemde.autosave();\n\t\t}, this.options.autosave.delay || 10000);\n\t} else {\n\t\tconsole.log(\"SimpleMDE: localStorage not available, cannot autosave\");\n\t}\n};\n\nSimpleMDE.prototype.clearAutosavedValue = function() {\n\tif(isLocalStorageAvailable()) {\n\t\tif(this.options.autosave == undefined || this.options.autosave.uniqueId == undefined || this.options.autosave.uniqueId == \"\") {\n\t\t\tconsole.log(\"SimpleMDE: You must set a uniqueId to clear the autosave value\");\n\t\t\treturn;\n\t\t}\n\n\t\tlocalStorage.removeItem(\"smde_\" + this.options.autosave.uniqueId);\n\t} else {\n\t\tconsole.log(\"SimpleMDE: localStorage not available, cannot autosave\");\n\t}\n};\n\nSimpleMDE.prototype.createSideBySide = function() {\n\tvar cm = this.codemirror;\n\tvar wrapper = cm.getWrapperElement();\n\tvar preview = wrapper.nextSibling;\n\n\tif(!preview || !/editor-preview-side/.test(preview.className)) {\n\t\tpreview = document.createElement(\"div\");\n\t\tpreview.className = \"editor-preview-side\";\n\t\twrapper.parentNode.insertBefore(preview, wrapper.nextSibling);\n\t}\n\n\t// Syncs scroll  editor -> preview\n\tvar cScroll = false;\n\tvar pScroll = false;\n\tcm.on(\"scroll\", function(v) {\n\t\tif(cScroll) {\n\t\t\tcScroll = false;\n\t\t\treturn;\n\t\t}\n\t\tpScroll = true;\n\t\tvar height = v.getScrollInfo().height - v.getScrollInfo().clientHeight;\n\t\tvar ratio = parseFloat(v.getScrollInfo().top) / height;\n\t\tvar move = (preview.scrollHeight - preview.clientHeight) * ratio;\n\t\tpreview.scrollTop = move;\n\t});\n\n\t// Syncs scroll  preview -> editor\n\tpreview.onscroll = function() {\n\t\tif(pScroll) {\n\t\t\tpScroll = false;\n\t\t\treturn;\n\t\t}\n\t\tcScroll = true;\n\t\tvar height = preview.scrollHeight - preview.clientHeight;\n\t\tvar ratio = parseFloat(preview.scrollTop) / height;\n\t\tvar move = (cm.getScrollInfo().height - cm.getScrollInfo().clientHeight) * ratio;\n\t\tcm.scrollTo(0, move);\n\t};\n\treturn preview;\n};\n\nSimpleMDE.prototype.createToolbar = function(items) {\n\titems = items || this.options.toolbar;\n\n\tif(!items || items.length === 0) {\n\t\treturn;\n\t}\n\tvar i;\n\tfor(i = 0; i < items.length; i++) {\n\t\tif(toolbarBuiltInButtons[items[i]] != undefined) {\n\t\t\titems[i] = toolbarBuiltInButtons[items[i]];\n\t\t}\n\t}\n\n\tvar bar = document.createElement(\"div\");\n\tbar.className = \"editor-toolbar\";\n\n\tvar self = this;\n\n\tvar toolbarData = {};\n\tself.toolbar = items;\n\n\tfor(i = 0; i < items.length; i++) {\n\t\tif(items[i].name == \"guide\" && self.options.toolbarGuideIcon === false)\n\t\t\tcontinue;\n\n\t\tif(self.options.hideIcons && self.options.hideIcons.indexOf(items[i].name) != -1)\n\t\t\tcontinue;\n\n\t\t// Fullscreen does not work well on mobile devices (even tablets)\n\t\t// In the future, hopefully this can be resolved\n\t\tif((items[i].name == \"fullscreen\" || items[i].name == \"side-by-side\") && isMobile())\n\t\t\tcontinue;\n\n\n\t\t// Don't include trailing separators\n\t\tif(items[i] === \"|\") {\n\t\t\tvar nonSeparatorIconsFollow = false;\n\n\t\t\tfor(var x = (i + 1); x < items.length; x++) {\n\t\t\t\tif(items[x] !== \"|\" && (!self.options.hideIcons || self.options.hideIcons.indexOf(items[x].name) == -1)) {\n\t\t\t\t\tnonSeparatorIconsFollow = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(!nonSeparatorIconsFollow)\n\t\t\t\tcontinue;\n\t\t}\n\n\n\t\t// Create the icon and append to the toolbar\n\t\t(function(item) {\n\t\t\tvar el;\n\t\t\tif(item === \"|\") {\n\t\t\t\tel = createSep();\n\t\t\t} else {\n\t\t\t\tel = createIcon(item, self.options.toolbarTips, self.options.shortcuts);\n\t\t\t}\n\n\t\t\t// bind events, special for info\n\t\t\tif(item.action) {\n\t\t\t\tif(typeof item.action === \"function\") {\n\t\t\t\t\tel.onclick = function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\titem.action(self);\n\t\t\t\t\t};\n\t\t\t\t} else if(typeof item.action === \"string\") {\n\t\t\t\t\tel.href = item.action;\n\t\t\t\t\tel.target = \"_blank\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttoolbarData[item.name || item] = el;\n\t\t\tbar.appendChild(el);\n\t\t})(items[i]);\n\t}\n\n\tself.toolbarElements = toolbarData;\n\n\tvar cm = this.codemirror;\n\tcm.on(\"cursorActivity\", function() {\n\t\tvar stat = getState(cm);\n\n\t\tfor(var key in toolbarData) {\n\t\t\t(function(key) {\n\t\t\t\tvar el = toolbarData[key];\n\t\t\t\tif(stat[key]) {\n\t\t\t\t\tel.className += \" active\";\n\t\t\t\t} else if(key != \"fullscreen\" && key != \"side-by-side\") {\n\t\t\t\t\tel.className = el.className.replace(/\\s*active\\s*/g, \"\");\n\t\t\t\t}\n\t\t\t})(key);\n\t\t}\n\t});\n\n\tvar cmWrapper = cm.getWrapperElement();\n\tcmWrapper.parentNode.insertBefore(bar, cmWrapper);\n\treturn bar;\n};\n\nSimpleMDE.prototype.createStatusbar = function(status) {\n\t// Initialize\n\tstatus = status || this.options.status;\n\tvar options = this.options;\n\tvar cm = this.codemirror;\n\n\n\t// Make sure the status variable is valid\n\tif(!status || status.length === 0)\n\t\treturn;\n\n\n\t// Set up the built-in items\n\tvar items = [];\n\tvar i, onUpdate, defaultValue;\n\n\tfor(i = 0; i < status.length; i++) {\n\t\t// Reset some values\n\t\tonUpdate = undefined;\n\t\tdefaultValue = undefined;\n\n\n\t\t// Handle if custom or not\n\t\tif(typeof status[i] === \"object\") {\n\t\t\titems.push({\n\t\t\t\tclassName: status[i].className,\n\t\t\t\tdefaultValue: status[i].defaultValue,\n\t\t\t\tonUpdate: status[i].onUpdate\n\t\t\t});\n\t\t} else {\n\t\t\tvar name = status[i];\n\n\t\t\tif(name === \"words\") {\n\t\t\t\tdefaultValue = function(el) {\n\t\t\t\t\tel.innerHTML = wordCount(cm.getValue());\n\t\t\t\t};\n\t\t\t\tonUpdate = function(el) {\n\t\t\t\t\tel.innerHTML = wordCount(cm.getValue());\n\t\t\t\t};\n\t\t\t} else if(name === \"lines\") {\n\t\t\t\tdefaultValue = function(el) {\n\t\t\t\t\tel.innerHTML = cm.lineCount();\n\t\t\t\t};\n\t\t\t\tonUpdate = function(el) {\n\t\t\t\t\tel.innerHTML = cm.lineCount();\n\t\t\t\t};\n\t\t\t} else if(name === \"cursor\") {\n\t\t\t\tdefaultValue = function(el) {\n\t\t\t\t\tel.innerHTML = \"0:0\";\n\t\t\t\t};\n\t\t\t\tonUpdate = function(el) {\n\t\t\t\t\tvar pos = cm.getCursor();\n\t\t\t\t\tel.innerHTML = pos.line + \":\" + pos.ch;\n\t\t\t\t};\n\t\t\t} else if(name === \"autosave\") {\n\t\t\t\tdefaultValue = function(el) {\n\t\t\t\t\tif(options.autosave != undefined && options.autosave.enabled === true) {\n\t\t\t\t\t\tel.setAttribute(\"id\", \"autosaved\");\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\titems.push({\n\t\t\t\tclassName: name,\n\t\t\t\tdefaultValue: defaultValue,\n\t\t\t\tonUpdate: onUpdate\n\t\t\t});\n\t\t}\n\t}\n\n\n\t// Create element for the status bar\n\tvar bar = document.createElement(\"div\");\n\tbar.className = \"editor-statusbar\";\n\n\n\t// Create a new span for each item\n\tfor(i = 0; i < items.length; i++) {\n\t\t// Store in temporary variable\n\t\tvar item = items[i];\n\n\n\t\t// Create span element\n\t\tvar el = document.createElement(\"span\");\n\t\tel.className = item.className;\n\n\n\t\t// Ensure the defaultValue is a function\n\t\tif(typeof item.defaultValue === \"function\") {\n\t\t\titem.defaultValue(el);\n\t\t}\n\n\n\t\t// Ensure the onUpdate is a function\n\t\tif(typeof item.onUpdate === \"function\") {\n\t\t\t// Create a closure around the span of the current action, then execute the onUpdate handler\n\t\t\tthis.codemirror.on(\"update\", (function(el, item) {\n\t\t\t\treturn function() {\n\t\t\t\t\titem.onUpdate(el);\n\t\t\t\t};\n\t\t\t}(el, item)));\n\t\t}\n\n\n\t\t// Append the item to the status bar\n\t\tbar.appendChild(el);\n\t}\n\n\n\t// Insert the status bar into the DOM\n\tvar cmWrapper = this.codemirror.getWrapperElement();\n\tcmWrapper.parentNode.insertBefore(bar, cmWrapper.nextSibling);\n\treturn bar;\n};\n\n/**\n * Get or set the text content.\n */\nSimpleMDE.prototype.value = function(val) {\n\tif(val === undefined) {\n\t\treturn this.codemirror.getValue();\n\t} else {\n\t\tthis.codemirror.getDoc().setValue(val);\n\t\treturn this;\n\t}\n};\n\n\n/**\n * Bind static methods for exports.\n */\nSimpleMDE.toggleBold = toggleBold;\nSimpleMDE.toggleItalic = toggleItalic;\nSimpleMDE.toggleStrikethrough = toggleStrikethrough;\nSimpleMDE.toggleBlockquote = toggleBlockquote;\nSimpleMDE.toggleHeadingSmaller = toggleHeadingSmaller;\nSimpleMDE.toggleHeadingBigger = toggleHeadingBigger;\nSimpleMDE.toggleHeading1 = toggleHeading1;\nSimpleMDE.toggleHeading2 = toggleHeading2;\nSimpleMDE.toggleHeading3 = toggleHeading3;\nSimpleMDE.toggleCodeBlock = toggleCodeBlock;\nSimpleMDE.toggleUnorderedList = toggleUnorderedList;\nSimpleMDE.toggleOrderedList = toggleOrderedList;\nSimpleMDE.cleanBlock = cleanBlock;\nSimpleMDE.drawLink = drawLink;\nSimpleMDE.drawImage = drawImage;\nSimpleMDE.drawTable = drawTable;\nSimpleMDE.drawHorizontalRule = drawHorizontalRule;\nSimpleMDE.undo = undo;\nSimpleMDE.redo = redo;\nSimpleMDE.togglePreview = togglePreview;\nSimpleMDE.toggleSideBySide = toggleSideBySide;\nSimpleMDE.toggleFullScreen = toggleFullScreen;\n\n/**\n * Bind instance methods for exports.\n */\nSimpleMDE.prototype.toggleBold = function() {\n\ttoggleBold(this);\n};\nSimpleMDE.prototype.toggleItalic = function() {\n\ttoggleItalic(this);\n};\nSimpleMDE.prototype.toggleStrikethrough = function() {\n\ttoggleStrikethrough(this);\n};\nSimpleMDE.prototype.toggleBlockquote = function() {\n\ttoggleBlockquote(this);\n};\nSimpleMDE.prototype.toggleHeadingSmaller = function() {\n\ttoggleHeadingSmaller(this);\n};\nSimpleMDE.prototype.toggleHeadingBigger = function() {\n\ttoggleHeadingBigger(this);\n};\nSimpleMDE.prototype.toggleHeading1 = function() {\n\ttoggleHeading1(this);\n};\nSimpleMDE.prototype.toggleHeading2 = function() {\n\ttoggleHeading2(this);\n};\nSimpleMDE.prototype.toggleHeading3 = function() {\n\ttoggleHeading3(this);\n};\nSimpleMDE.prototype.toggleCodeBlock = function() {\n\ttoggleCodeBlock(this);\n};\nSimpleMDE.prototype.toggleUnorderedList = function() {\n\ttoggleUnorderedList(this);\n};\nSimpleMDE.prototype.toggleOrderedList = function() {\n\ttoggleOrderedList(this);\n};\nSimpleMDE.prototype.cleanBlock = function() {\n\tcleanBlock(this);\n};\nSimpleMDE.prototype.drawLink = function() {\n\tdrawLink(this);\n};\nSimpleMDE.prototype.drawImage = function() {\n\tdrawImage(this);\n};\nSimpleMDE.prototype.drawTable = function() {\n\tdrawTable(this);\n};\nSimpleMDE.prototype.drawHorizontalRule = function() {\n\tdrawHorizontalRule(this);\n};\nSimpleMDE.prototype.undo = function() {\n\tundo(this);\n};\nSimpleMDE.prototype.redo = function() {\n\tredo(this);\n};\nSimpleMDE.prototype.togglePreview = function() {\n\ttogglePreview(this);\n};\nSimpleMDE.prototype.toggleSideBySide = function() {\n\ttoggleSideBySide(this);\n};\nSimpleMDE.prototype.toggleFullScreen = function() {\n\ttoggleFullScreen(this);\n};\n\nSimpleMDE.prototype.isPreviewActive = function() {\n\tvar cm = this.codemirror;\n\tvar wrapper = cm.getWrapperElement();\n\tvar preview = wrapper.lastChild;\n\n\treturn /editor-preview-active/.test(preview.className);\n};\n\nSimpleMDE.prototype.isSideBySideActive = function() {\n\tvar cm = this.codemirror;\n\tvar wrapper = cm.getWrapperElement();\n\tvar preview = wrapper.nextSibling;\n\n\treturn /editor-preview-active-side/.test(preview.className);\n};\n\nSimpleMDE.prototype.isFullscreenActive = function() {\n\tvar cm = this.codemirror;\n\n\treturn cm.getOption(\"fullScreen\");\n};\n\nSimpleMDE.prototype.getState = function() {\n\tvar cm = this.codemirror;\n\n\treturn getState(cm);\n};\n\nSimpleMDE.prototype.toTextArea = function() {\n\tvar cm = this.codemirror;\n\tvar wrapper = cm.getWrapperElement();\n\n\tif(wrapper.parentNode) {\n\t\tif(this.gui.toolbar) {\n\t\t\twrapper.parentNode.removeChild(this.gui.toolbar);\n\t\t}\n\t\tif(this.gui.statusbar) {\n\t\t\twrapper.parentNode.removeChild(this.gui.statusbar);\n\t\t}\n\t\tif(this.gui.sideBySide) {\n\t\t\twrapper.parentNode.removeChild(this.gui.sideBySide);\n\t\t}\n\t}\n\n\tcm.toTextArea();\n\n\tif(this.autosaveTimeoutId) {\n\t\tclearTimeout(this.autosaveTimeoutId);\n\t\tthis.autosaveTimeoutId = undefined;\n\t\tthis.clearAutosavedValue();\n\t}\n};\n\nmodule.exports = SimpleMDE;"]},"metadata":{},"sourceType":"script"}